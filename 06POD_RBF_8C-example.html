<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ITHACA-FV: 06POD_RBF.C</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ithaca-fv-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="">ITHACA-FV</a>
   &#160;<span id="projectnumber"><a href="">5.0</a></span>
   </div>
   <div id="projectbrief"><a href="https://mathlab.sissa.it/">SISSA mathLab</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">06POD_RBF.C</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="intro_podRBF"></a>
Introduction to turorial 6</h1>
<p class="">The problems consists of steady Navier-Stokes problem with a parameterized velocity at the inlet. The physical problem is the pitz-daily depicted in the following image </p><div class="image">
<img src="pitzdaily.png" alt="pitzdaily.png"/>
</div>
<p> The velocity at the inlet is parameterized in both x and y directions. In other words, the parameters in this setting are the magnitude of the velocity at the inlet and the inclination of the velocity with respect to the inlet. </p>
<h1><a class="anchor" id="CODE"></a>
A detailed look into the code</h1>
<p class="">This section explains the main steps necessary to construct the tutorial N°6.</p>
<h2><a class="anchor" id="header"></a>
The necessary header files</h2>
<p class="">First of all let's have a look into the header files which have to be included, indicating what they are responsible for:</p>
 The OpenFOAM header files: <p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;fvCFD.H&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;fvOptions.H&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;IOmanip.H&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;simpleControl.H&quot;</span></div></div><!-- fragment --></p>
<p class="">ITHACA-FV header files, &lt;<a class="el" href="ITHACAstream_8H.html" title="Header file of the ITHACAstream class, it contains the implementation of several methods for input ou...">ITHACAstream.H</a>&gt; is responsible for reading and exporting the fields and other sorts of data. &lt;<a class="el" href="ITHACAutilities_8H.html" title="Header file of the ITHACAutilities namespace.">ITHACAutilities.H</a>&gt; has the utilities which compute the mass matrices, fields norms, fields error,...etc. &lt;<a class="el" href="Foam2Eigen_8H.html" title="Header file of the Foam2Eigen class.">Foam2Eigen.H</a>&gt; is for converting fields and other data from OpenFOAM to <a class="el" href="namespaceEigen.html">Eigen</a> format. &lt;<a class="el" href="ITHACAPOD_8H.html" title="Header file of the ITHACAPOD class.">ITHACAPOD.H</a>&gt; is for the computation of the POD modes. <p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAutilities_8H.html">ITHACAutilities.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="Foam2Eigen_8H.html">Foam2Eigen.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div></div><!-- fragment --><p> The <a class="el" href="namespaceEigen.html">Eigen</a> library for matrix manipulation and linear and non-linear algebra operations: <p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Eigen/Dense&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;Eigen/SVD&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;Eigen/SparseLU&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="EigenFunctions_8H.html">EigenFunctions.H</a>&quot;</span></div></div><!-- fragment --><p> chrono to compute the speedup <p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div></div><!-- fragment --><p> The header files of ITHACA-FV necessary for this tutorial are: &lt;<a class="el" href="reductionProblem_8H.html" title="Header file of the reductionProblem class.">reductionProblem.H</a>&gt; A general class for the implementation of a full order parameterized problem. &lt;<a class="el" href="steadyNS_8H.html" title="Header file of the steadyNS class.">steadyNS.H</a>&gt; is for the full order steady NS problem , &lt;<a class="el" href="SteadyNSTurb_8H.html" title="Header file of the SteadyNSTurb class.">SteadyNSTurb.H</a>&gt; is the child of &lt;<a class="el" href="steadyNS_8H.html" title="Header file of the steadyNS class.">steadyNS.H</a>&gt; and it is the class for the full order steady NS turbulent problem. Finally &lt;reducedSteadyNS.H&gt; and &lt;<a class="el" href="ReducedSteadyNSTurb_8H.html" title="Header file of the ReducedSteadyNSTurb class.">ReducedSteadyNSTurb.H</a>&gt; are for the construction of the reduced order problems <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reductionProblem_8H.html">reductionProblem.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="steadyNS_8H.html">steadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SteadyNSTurb_8H.html">SteadyNSTurb.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ReducedSteadyNS_8H.html">ReducedSteadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ReducedSteadyNSTurb_8H.html">ReducedSteadyNSTurb.H</a>&quot;</span></div></div><!-- fragment --></p>
<h2><a class="anchor" id="classtutorial06"></a>
Definition of the tutorial06 class</h2>
<p class="">We define the <a class="el" href="classtutorial06.html" title="Class where the tutorial number 6 is implemented.">tutorial06</a> class as a child of the <a class="el" href="classSteadyNSTurb.html" title="Implementation of a parametrized full order  steady turbulent Navier Stokes problem  and preparation ...">SteadyNSTurb</a> class. The constructor is defined with members that are the fields required to be manipulated during the resolution of the full order problem using simpleFoam. Such fields are also initialized with the same initial conditions in the solver. <p><div class="fragment"><div class="line"><span class="keyword">class </span><a name="_a0"></a><a class="code" href="classtutorial06.html">tutorial06</a> : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="classSteadyNSTurb.html">SteadyNSTurb</a></div><div class="line">{</div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">explicit</span> <a name="a2"></a><a class="code" href="classtutorial06.html#a7a63444769e473558ba02b6135d38858">tutorial06</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">            :</div><div class="line">            <a name="a3"></a><a class="code" href="classSteadyNSTurb.html#acf59090fea98d6e00a1ea8156ae9469e">SteadyNSTurb</a>(argc, argv),</div><div class="line">            <a name="a4"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>(<a name="a5"></a><a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div><div class="line">            <a name="a6"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>(<a name="a7"></a><a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>()),</div><div class="line">            <a name="a8"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2UnsteadyBB_2createFields_8H.html#a8e5458cd4970344785f66c50600689fd">nut</a>(<a name="a9"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2SteadyNSTurb_2createFields_8H.html#a6474dce93ee9fd1d383863a810d832e3">_nut</a>())</div><div class="line">        {}</div></div><!-- fragment --></p>
<p class="">Inside the <a class="el" href="classtutorial06.html" title="Class where the tutorial number 6 is implemented.">tutorial06</a> class we define the offlineSolve method according to the specific parameterized problem that needs to be solved. If the offline solve has been previously performed then the method just reads the existing snapshots from the Offline directory, and if the offline solve has been started but not completed then it continues the offline stage from the last snapshot computed. If the procedure has not started at all, the method loops over all the parameters samples, changes the inlet velocity components at the inlet with the iterable parameter sample for both components of the velocity then it performs the offline solve. <p><div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a name="a10"></a><a class="code" href="classtutorial06.html#aecc518758bcaae3b0a514db77e6263cf">offlineSolve</a>()</div><div class="line">        {</div><div class="line">            Vector&lt;double&gt; inl(0, 0, 0);</div><div class="line">            List&lt;scalar&gt; mu_now(2);</div><div class="line"></div><div class="line">            <span class="comment">// if the offline solution is already performed read the fields</span></div><div class="line">            <span class="keywordflow">if</span> (<a name="a11"></a><a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div><div class="line">            {</div><div class="line">                <a name="a12"></a><a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a name="a13"></a><a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a name="a14"></a><a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a name="a15"></a><a class="code" href="classSteadyNSTurb.html#a4bda4f74c0cf2abe5f4096c663b7a8a8">nutFields</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2UnsteadyBB_2createFields_8H.html#a8e5458cd4970344785f66c50600689fd">nut</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line"></div><div class="line">                <span class="comment">// if the offline stage is not completed then resume it</span></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.size() &lt; <a name="a16"></a><a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.rows())</div><div class="line">                {</div><div class="line">                    Vector&lt;double&gt; Uinl(0, 0, 0);</div><div class="line">                    label BCind = 0;</div><div class="line"></div><div class="line">                    <span class="keywordflow">for</span> (label <a name="a17"></a><a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = <a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.size(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.rows(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div><div class="line">                    {</div><div class="line">                        Uinl[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 0);</div><div class="line">                        Uinl[1] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 1);</div><div class="line">                        <a name="a18"></a><a class="code" href="namespaceITHACAutilities.html#aaf2554bab8cb1c5a0aac263380019ebd">assignBC</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>(), BCind, Uinl);</div><div class="line">                        <a name="a19"></a><a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a> = <a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.size() + 1;</div><div class="line">                        <a name="a20"></a><a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(<span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                    }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                Vector&lt;double&gt; Uinl(0, 0, 0);</div><div class="line">                label BCind = 0;</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (label <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = 0; <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.rows(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div><div class="line">                {</div><div class="line">                    Uinl[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 0);</div><div class="line">                    Uinl[1] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 1);</div><div class="line">                    <a class="code" href="namespaceITHACAutilities.html#aaf2554bab8cb1c5a0aac263380019ebd">assignBC</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>(), BCind, Uinl);</div><div class="line">                    <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(<span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div></div><!-- fragment --></p>
<p class="">This offlineSolve method is just designed to compute the full order solutions for a set of parameters samples called par, the goal is to compute the full order solution for a cross validation test samples which will be used to test the reduced order model in the online stage.</p>
<p class=""><p><div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial06.html#aecc518758bcaae3b0a514db77e6263cf">offlineSolve</a>(Eigen::MatrixXd par, fileName folder)</div><div class="line">        {</div><div class="line">            Vector&lt;double&gt; inl(0, 0, 0);</div><div class="line">            List&lt;scalar&gt; mu_now(2);</div><div class="line">            Vector&lt;double&gt; Uinl(0, 0, 0);</div><div class="line">            label BCind = 0;</div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (label <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = 0; <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; par.rows(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div><div class="line">            {</div><div class="line">                Uinl[0] = par(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 0);</div><div class="line">                Uinl[1] = par(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 1);</div><div class="line">                <a class="code" href="namespaceITHACAutilities.html#aaf2554bab8cb1c5a0aac263380019ebd">assignBC</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>(), BCind, Uinl);</div><div class="line">                <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(folder);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(fileName folder)</div><div class="line">        {</div><div class="line">            Time&amp; <a name="a21"></a><a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a> = <a name="a22"></a><a class="code" href="classsteadyNS.html#a4493d1f1ce7e2008c85b1dde7c027de4">_runTime</a>();</div><div class="line">            fvMesh&amp; <a name="a23"></a><a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a> = <a name="a24"></a><a class="code" href="classsteadyNS.html#a6a233a5c129864684e67e41d04983e01">_mesh</a>();</div><div class="line">            volScalarField&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a> = <a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>();</div><div class="line">            volVectorField&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a> = <a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>();</div><div class="line">            surfaceScalarField&amp; <a name="a25"></a><a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> = <a name="a26"></a><a class="code" href="classsteadyNS.html#a27dd336cf3b9757ba406b3d3926ac299">_phi</a>();</div><div class="line">            fv::options&amp; fvOptions = <a name="a27"></a><a class="code" href="msrProblem_2createFvOptions_8H.html#a74771b34ee266ad9dbbc9e01872aa7b4">_fvOptions</a>();</div><div class="line">            simpleControl&amp; simple = <a name="a28"></a><a class="code" href="classsteadyNS.html#a2eedc2d1f931744a2e2ba785d803eb5f">_simple</a>();</div><div class="line">            IOMRFZoneList&amp; MRF = <a name="a29"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ab6622d3fa81ea4ad8462f16aa6a8da07">_MRF</a>();</div><div class="line">            singlePhaseTransportModel&amp; <a name="a30"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#aaa15f2fa61d58ef55036975f0a15cd3d">laminarTransport</a> = <a name="a31"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a2196113e1201a3f47ea70ae5e2193751">_laminarTransport</a>();</div><div class="line"><span class="preprocessor">#include &quot;NLsolve.H&quot;</span></div><div class="line">            <a name="a32"></a><a class="code" href="namespaceITHACAstream.html#a36ae0d53d94f890fdfe72086003eacee">ITHACAstream::exportSolution</a>(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>, name(<a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>), folder);</div><div class="line">            <a class="code" href="namespaceITHACAstream.html#a36ae0d53d94f890fdfe72086003eacee">ITHACAstream::exportSolution</a>(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>, name(<a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>), folder);</div><div class="line">            volScalarField <a class="code" href="src_2ITHACA__FOMPROBLEMS_2SteadyNSTurb_2createFields_8H.html#a6474dce93ee9fd1d383863a810d832e3">_nut</a>(<a name="a33"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a7eb708ed6afd5d2b8cec73f71e0ff2d4">turbulence</a>-&gt;nut());</div><div class="line">            <a class="code" href="namespaceITHACAstream.html#a36ae0d53d94f890fdfe72086003eacee">ITHACAstream::exportSolution</a>(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2SteadyNSTurb_2createFields_8H.html#a6474dce93ee9fd1d383863a810d832e3">_nut</a>, name(<a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>), folder);</div><div class="line">            <a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.append(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>);</div><div class="line">            <a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>.append(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>);</div><div class="line">            <a class="code" href="classSteadyNSTurb.html#a4bda4f74c0cf2abe5f4096c663b7a8a8">nutFields</a>.append(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2SteadyNSTurb_2createFields_8H.html#a6474dce93ee9fd1d383863a810d832e3">_nut</a>);</div><div class="line">            <a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>++;</div><div class="line">        }</div><div class="line">};</div></div><!-- fragment --> </p>
<h2><a class="anchor" id="main"></a>
Definition of the main function</h2>
<p class="">In this section we address the definition of the main function. First we construct the object "example" of type <a class="el" href="classtutorial06.html" title="Class where the tutorial number 6 is implemented.">tutorial06</a>:</p>
<p class=""><div class="fragment"><div class="line">    <a class="code" href="classtutorial06.html">tutorial06</a> example(argc, argv);</div></div><!-- fragment --></p>
<p class="">Then we read the parameters samples for the offline stage and the ones for the online stages using method readMatrix in the <a class="el" href="namespaceITHACAstream.html" title="Namespace for input-output manipulation.">ITHACAstream</a> class</p>
<p class=""><p><div class="fragment"><div class="line">    word par_offline(<span class="stringliteral">&quot;./par_offline&quot;</span>);</div><div class="line">    word par_new(<span class="stringliteral">&quot;./par_online&quot;</span>);</div><div class="line">    Eigen::MatrixXd par_online = <a name="a34"></a><a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_new);</div><div class="line">    example.mu = <a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_offline);</div></div><!-- fragment --></p>
<p class="">Then we set the inlet boundaries where we have parameterized boundary conditions and we define in which directions we have the parameterization. <p><div class="fragment"><div class="line">    example.inletIndex.resize(2, 2);</div><div class="line">    example.inletIndex(0, 0) = 0;</div><div class="line">    example.inletIndex(0, 1) = 0;</div><div class="line">    example.inletIndex(1, 0) = 0;</div><div class="line">    example.inletIndex(1, 1) = 1;</div></div><!-- fragment --></p>
<p class="">Then we parse the ITHACAdict file to determine the number of modes to be written out and also the ones to be used for the projection of the velocity, pressure, supremizer and the eddy viscosity:</p>
<p class=""><p><div class="fragment"><div class="line">    <a name="_a35"></a><a class="code" href="classITHACAparameters.html">ITHACAparameters</a>* <a name="a36"></a><a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a> = <a name="a37"></a><a class="code" href="classITHACAparameters.html#adf4e7e15954b8779d57ed6478a19027f">ITHACAparameters::getInstance</a>(example._mesh(),</div><div class="line">                             example._runTime());</div><div class="line">    <span class="comment">// Read parameters from ITHACAdict file</span></div><div class="line">    <span class="keywordtype">int</span> NmodesU = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a name="a38"></a><a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesU&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesP = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesP&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUP = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUP&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesNUT = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesNUT&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesProject = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesProject&quot;</span>, 5);</div></div><!-- fragment --></p>
<p class="">Now we are ready to perform the offline stage: <div class="fragment"><div class="line">    example.offlineSolve();</div></div><!-- fragment --></p>
<p class="">The next step is to read the lifting functions <div class="fragment"><div class="line">    <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(example.liftfield, example.U, <span class="stringliteral">&quot;./lift/&quot;</span>);</div></div><!-- fragment --></p>
<p class="">Then we compute the homogeneous velocity field snapshots, and then we output them <p><div class="fragment"><div class="line">    example.computeLift(example.Ufield, example.liftfield, example.Uomfield);</div><div class="line">    <span class="comment">// Export the homogeneous velocity snapshots</span></div><div class="line">    <a name="a39"></a><a class="code" href="namespaceITHACAstream.html#a3dbb939ce5c8b0b3104b07050df0d9cb">ITHACAstream::exportFields</a>(example.Uomfield, <span class="stringliteral">&quot;./ITHACAoutput/Offline&quot;</span>,</div></div><!-- fragment --></p>
<p class="">After that, the modes for velocity, pressure and the eddy viscosity are obtained: <p><div class="fragment"><div class="line">    <a name="a40"></a><a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Uomfield, example.Umodes, example._U().name(),</div><div class="line">                        example.podex,</div><div class="line">                        example.supex, 0, NmodesProject);</div><div class="line">    <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example.p().name(),</div><div class="line">                        example.podex,</div><div class="line">                        example.supex, 0, NmodesProject);</div><div class="line">    <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.nutFields, example.nutModes, example._nut().name(),</div></div><!-- fragment --></p>
<p class="">Then we compute the supremizer modes on the basis of the POD pressure modes obtained from the last step</p>
<p class=""><div class="fragment"><div class="line">    example.solvesupremizer(<span class="stringliteral">&quot;modes&quot;</span>);</div></div><!-- fragment --></p>
<p class="">then we perform the projection onto the POD modes <div class="fragment"><div class="line">    example.projectSUP(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesU, NmodesP, NmodesSUP,</div></div><!-- fragment --></p>
<p class="">Now we proceed to the ROM part of the tutorial, at first we construct an object of the class &lt;<a class="el" href="ReducedSteadyNSTurb_8H.html" title="Header file of the ReducedSteadyNSTurb class.">ReducedSteadyNSTurb.H</a>&gt;.</p>
<p class=""><div class="fragment"><div class="line">    <span class="comment">// Set value of the reduced viscosity and the penalty factor</span></div></div><!-- fragment --></p>
<p class="">Now we set the value of the reduced viscosity and we initialize the penalty factor which will be zero</p>
<p class=""><p><div class="fragment"><div class="line">    pod_rbf.nu = 1e-3;</div><div class="line">    pod_rbf.tauU.resize(2, 1);</div></div><!-- fragment --></p>
<p class="">We create the matrix rbfCoeff in order to store the values of the interpolated eddy viscosity coefficient using the RBF in the online stage</p>
<p class=""><p><div class="fragment"><div class="line">    <span class="comment">// We create the matrix rbfCoeff which will store the values of the interpolation results for the eddy viscosity field</span></div><div class="line">    Eigen::MatrixXd rbfCoeff;</div></div><!-- fragment --></p>
<p class="">Now we solve the online reduced system for the parameter values stored in par_online which is a different set of samples for the parameters than the one used in the offline stage. This represent a cross validation test for assessing the reduced order model in a better way.</p>
<p class=""><p><div class="fragment"><div class="line">    <span class="comment">// Perform an online solve for the new values of inlet velocities</span></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; par_online.rows(); k++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd velNow(2, 1);</div><div class="line">        velNow(0, 0) = par_online(k, 0);</div><div class="line">        velNow(1, 0) = par_online(k, 1);</div><div class="line">        pod_rbf.tauU(0, 0) = 0;</div><div class="line">        pod_rbf.tauU(1, 0) = 0;</div><div class="line">        pod_rbf.solveOnlineSUP(velNow);</div><div class="line">        rbfCoeff.col(k) = pod_rbf.rbfCoeff;</div><div class="line">        Eigen::MatrixXd tmp_sol(pod_rbf.y.rows() + 1, 1);</div><div class="line">        tmp_sol(0) = k + 1;</div><div class="line">        tmp_sol.col(0).tail(pod_rbf.y.rows()) = pod_rbf.y;</div><div class="line">        pod_rbf.online_solution.append(tmp_sol);</div><div class="line">    }</div></div><!-- fragment --></p>
<p class="">Now we output the matrix rbfCoeff and the online solution</p>
<p class=""><p><div class="fragment"><div class="line">    <a name="a41"></a><a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(rbfCoeff, <span class="stringliteral">&quot;rbfCoeff&quot;</span>, <span class="stringliteral">&quot;python&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/Matrices/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(rbfCoeff, <span class="stringliteral">&quot;rbfCoeff&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/Matrices/&quot;</span>);</div><div class="line">    <span class="comment">// Save the online solution</span></div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_rbf.online_solution, <span class="stringliteral">&quot;red_coeff&quot;</span>, <span class="stringliteral">&quot;python&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeff&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_rbf.online_solution, <span class="stringliteral">&quot;red_coeff&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeff&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_rbf.online_solution, <span class="stringliteral">&quot;red_coeff&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div></div><!-- fragment --></p>
<p class="">The last step is to reconstruct the velocity and pressure fields using the reduced solution obtained in the online stage and with the POD modes computed earlier on</p>
<p class=""><p><div class="fragment"><div class="line">    pod_rbf.reconstruct(<span class="keyword">true</span>, <span class="stringliteral">&quot;./ITHACAoutput/Reconstruction/&quot;</span>);</div><div class="line">    <span class="comment">// Create an object of the laminar class</span></div><div class="line">    <a name="_a42"></a><a class="code" href="classreducedSteadyNS.html">reducedSteadyNS</a> pod_normal(</div><div class="line">        example);</div><div class="line">    <span class="comment">// Set value of the reduced viscosity and the penalty factor</span></div><div class="line">    pod_normal.nu = 1e-3;</div><div class="line">    pod_normal.tauU.resize(2, 1);</div><div class="line"></div><div class="line">    <span class="comment">// Perform an online solve for the new values of inlet velocities</span></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; par_online.rows(); k++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd vel_now(2, 1);</div><div class="line">        vel_now(0, 0) = par_online(k, 0);</div><div class="line">        vel_now(1, 0) = par_online(k, 1);</div><div class="line">        pod_normal.tauU(0, 0) = 0;</div><div class="line">        pod_normal.tauU(1, 0) = 0;</div><div class="line">        pod_normal.solveOnline_sup(vel_now);</div><div class="line">        Eigen::MatrixXd tmp_sol(pod_normal.y.rows() + 1, 1);</div><div class="line">        tmp_sol(0) = k + 1;</div><div class="line">        tmp_sol.col(0).tail(pod_normal.y.rows()) = pod_normal.y;</div><div class="line">        pod_normal.online_solution.append(tmp_sol);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Save the online solution</span></div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_normal.online_solution, <span class="stringliteral">&quot;red_coeffnew&quot;</span>, <span class="stringliteral">&quot;python&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeffnew&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_normal.online_solution, <span class="stringliteral">&quot;red_coeffnew&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeffnew&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_normal.online_solution, <span class="stringliteral">&quot;red_coeffnew&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeffnew&quot;</span>);</div><div class="line">    <span class="comment">// Reconstruct and export the solution</span></div><div class="line">    pod_normal.reconstruct(<span class="keyword">true</span>, <span class="stringliteral">&quot;./ITHACAoutput/Lam_Rec/&quot;</span>);</div><div class="line">    <span class="comment">// Solve the full order problem for the online velocity values for the purpose of comparison</span></div><div class="line">    <span class="comment">// if (ITHACAutilities::check_folder(&quot;./ITHACAoutput/Offline_check&quot;) == false)</span></div><div class="line">    <span class="comment">// {</span></div><div class="line">    <span class="comment">//     example.offlineSolve(par_online, &quot;./ITHACAoutput/Offline_check/&quot;);</span></div><div class="line">    <span class="comment">//     ITHACAutilities::createSymLink(&quot;./ITHACAoutput/Offline_check&quot;);</span></div><div class="line">    <span class="comment">// }</span></div><div class="line">    Eigen::MatrixXd errFrobU = <a name="a43"></a><a class="code" href="namespaceITHACAutilities.html#ab50e0c5e1738a8ba59182ad433ca140a">ITHACAutilities::errorFrobRel</a>(example.Ufield,</div><div class="line">                               pod_rbf.uRecFields);</div><div class="line">    Eigen::MatrixXd errFrobP =  <a class="code" href="namespaceITHACAutilities.html#ab50e0c5e1738a8ba59182ad433ca140a">ITHACAutilities::errorFrobRel</a>(example.Pfield,</div><div class="line">                                pod_rbf.pRecFields);</div><div class="line">    Eigen::MatrixXd errFrobNut =  <a class="code" href="namespaceITHACAutilities.html#ab50e0c5e1738a8ba59182ad433ca140a">ITHACAutilities::errorFrobRel</a>(example.nutFields,</div><div class="line">                                  pod_rbf.nutRecFields);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errFrobU, <span class="stringliteral">&quot;errFrobU&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsFrob/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errFrobP, <span class="stringliteral">&quot;errFrobP&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsFrob/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errFrobNut, <span class="stringliteral">&quot;errFrobNut&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsFrob/&quot;</span>);</div><div class="line">    Eigen::MatrixXd errL2U = <a name="a44"></a><a class="code" href="namespaceITHACAutilities.html#ac150bf2cd5f5f146a3dba2cb60d2f16a">ITHACAutilities::errorL2Rel</a>(example.Ufield,</div><div class="line">                             pod_rbf.uRecFields);</div><div class="line">    Eigen::MatrixXd errL2P =  <a class="code" href="namespaceITHACAutilities.html#ac150bf2cd5f5f146a3dba2cb60d2f16a">ITHACAutilities::errorL2Rel</a>(example.Pfield,</div><div class="line">                              pod_rbf.pRecFields);</div><div class="line">    Eigen::MatrixXd errL2Nut =  <a class="code" href="namespaceITHACAutilities.html#ac150bf2cd5f5f146a3dba2cb60d2f16a">ITHACAutilities::errorL2Rel</a>(example.nutFields,</div><div class="line">                                pod_rbf.nutRecFields);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errL2U, <span class="stringliteral">&quot;errL2U&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsL2/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errL2P, <span class="stringliteral">&quot;errL2P&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsL2/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errL2Nut, <span class="stringliteral">&quot;errL2Nut&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsL2/&quot;</span>);</div><div class="line">    exit(0);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//--------</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// \until nuRec</span></div></div><!-- fragment --></p>
<p class="">After we carried out the online stage using an object of the turbulent class &lt;<a class="el" href="ReducedSteadyNSTurb_8H.html" title="Header file of the ReducedSteadyNSTurb class.">ReducedSteadyNSTurb.H</a>&gt;, now we will repeat same procedure but for the class that does not take into consideration turbulence at the reduced order level which is &lt;reducedSteadyNS.H&gt;. This allows us at the end of comparing the reduced results obtained from both classes.</p>
<p class=""><p><div class="fragment"><div class="line"><span class="comment">/// \skipline pod_normal</span></div><div class="line"><span class="comment">/// \until pod_normal.reconstruct_sup</span></div></div><!-- fragment --></p>
<p class="">We finally solve the offline stage for the checking parameters set that was used for validating the reduced order model <p><div class="fragment"><div class="line"><span class="comment">/// \skipline offlineSolve</span></div><div class="line"><span class="comment">/// \until createSymLink</span></div></div><!-- fragment --></p>
<div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div><div class="line"><span class="comment">     ██╗████████╗██╗  ██╗ █████╗  ██████╗ █████╗       ███████╗██╗   ██╗</span></div><div class="line"><span class="comment">     ██║╚══██╔══╝██║  ██║██╔══██╗██╔════╝██╔══██╗      ██╔════╝██║   ██║</span></div><div class="line"><span class="comment">     ██║   ██║   ███████║███████║██║     ███████║█████╗█████╗  ██║   ██║</span></div><div class="line"><span class="comment">     ██║   ██║   ██╔══██║██╔══██║██║     ██╔══██║╚════╝██╔══╝  ╚██╗ ██╔╝</span></div><div class="line"><span class="comment">     ██║   ██║   ██║  ██║██║  ██║╚██████╗██║  ██║      ██║      ╚████╔╝</span></div><div class="line"><span class="comment">     ╚═╝   ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝      ╚═╝       ╚═══╝</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> * In real Time Highly Advanced Computational Applications for Finite Volumes</span></div><div class="line"><span class="comment"> * Copyright (C) 2017 by the ITHACA-FV authors</span></div><div class="line"><span class="comment">-------------------------------------------------------------------------------</span></div><div class="line"><span class="comment">License</span></div><div class="line"><span class="comment">    This file is part of ITHACA-FV</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    ITHACA-FV is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment">    it under the terms of the GNU Lesser General Public License as published by</span></div><div class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><span class="comment">    (at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    ITHACA-FV is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><span class="comment">    GNU Lesser General Public License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    You should have received a copy of the GNU Lesser General Public License</span></div><div class="line"><span class="comment">    along with ITHACA-FV. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Description</span></div><div class="line"><span class="comment">    Example of NS-Stokes Reduction Problem for Turbulent Flow Case</span></div><div class="line"><span class="comment">SourceFiles</span></div><div class="line"><span class="comment">    06POD_RBF.C</span></div><div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div><div class="line"><span class="preprocessor">#include &quot;fvCFD.H&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;fvOptions.H&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;IOmanip.H&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;simpleControl.H&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAutilities_8H.html">ITHACAutilities.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="Foam2Eigen_8H.html">Foam2Eigen.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;Eigen/Dense&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;Eigen/SVD&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;Eigen/SparseLU&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="EigenFunctions_8H.html">EigenFunctions.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reductionProblem_8H.html">reductionProblem.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="steadyNS_8H.html">steadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SteadyNSTurb_8H.html">SteadyNSTurb.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ReducedSteadyNS_8H.html">ReducedSteadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ReducedSteadyNSTurb_8H.html">ReducedSteadyNSTurb.H</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classtutorial06.html">tutorial06</a> : <span class="keyword">public</span> <a class="code" href="classSteadyNSTurb.html">SteadyNSTurb</a></div><div class="line">{</div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">explicit</span> <a class="code" href="classtutorial06.html#a7a63444769e473558ba02b6135d38858">tutorial06</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">            :</div><div class="line">            <a class="code" href="classSteadyNSTurb.html#acf59090fea98d6e00a1ea8156ae9469e">SteadyNSTurb</a>(argc, argv),</div><div class="line">            <a name="a45"></a><a class="code" href="classtutorial06.html#a33b6b6be45459eb32c9b86d46c5ef790">U</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div><div class="line">            <a name="a46"></a><a class="code" href="classtutorial06.html#a6369844e0ed5847d056a9c3ec5945fe4">p</a>(<a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>()),</div><div class="line">            <a name="a47"></a><a class="code" href="classtutorial06.html#acbeb0c573672cb74aa2c757ea64ea951">nut</a>(<a name="a48"></a><a class="code" href="classSteadyNSTurb.html#a43d6ca286d08b8715a79fbcd1b6ef29d">_nut</a>())</div><div class="line">        {}</div><div class="line">        <span class="comment">// Relevant Fields</span></div><div class="line">        volVectorField&amp; <a class="code" href="classtutorial06.html#a33b6b6be45459eb32c9b86d46c5ef790">U</a>;</div><div class="line">        volScalarField&amp; <a class="code" href="classtutorial06.html#a6369844e0ed5847d056a9c3ec5945fe4">p</a>;</div><div class="line">        volScalarField&amp; <a class="code" href="classtutorial06.html#acbeb0c573672cb74aa2c757ea64ea951">nut</a>;</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial06.html#aecc518758bcaae3b0a514db77e6263cf">offlineSolve</a>()</div><div class="line">        {</div><div class="line">            Vector&lt;double&gt; inl(0, 0, 0);</div><div class="line">            List&lt;scalar&gt; mu_now(2);</div><div class="line"></div><div class="line">            <span class="comment">// if the offline solution is already performed read the fields</span></div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="classtutorial06.html#a33b6b6be45459eb32c9b86d46c5ef790">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>, <a class="code" href="classtutorial06.html#a6369844e0ed5847d056a9c3ec5945fe4">p</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a class="code" href="classSteadyNSTurb.html#a4bda4f74c0cf2abe5f4096c663b7a8a8">nutFields</a>, <a class="code" href="classtutorial06.html#acbeb0c573672cb74aa2c757ea64ea951">nut</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line"></div><div class="line">                <span class="comment">// if the offline stage is not completed then resume it</span></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.size() &lt; <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.rows())</div><div class="line">                {</div><div class="line">                    Vector&lt;double&gt; Uinl(0, 0, 0);</div><div class="line">                    label BCind = 0;</div><div class="line"></div><div class="line">                    <span class="keywordflow">for</span> (label <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = <a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.size(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.rows(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div><div class="line">                    {</div><div class="line">                        Uinl[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 0);</div><div class="line">                        Uinl[1] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 1);</div><div class="line">                        <a name="a49"></a><a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>(), BCind, Uinl);</div><div class="line">                        <a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a> = <a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.size() + 1;</div><div class="line">                        <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(<span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                Vector&lt;double&gt; Uinl(0, 0, 0);</div><div class="line">                label BCind = 0;</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (label <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = 0; <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.rows(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div><div class="line">                {</div><div class="line">                    Uinl[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 0);</div><div class="line">                    Uinl[1] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 1);</div><div class="line">                    <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>(), BCind, Uinl);</div><div class="line">                    <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(<span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial06.html#aecc518758bcaae3b0a514db77e6263cf">offlineSolve</a>(Eigen::MatrixXd par, fileName folder)</div><div class="line">        {</div><div class="line">            Vector&lt;double&gt; inl(0, 0, 0);</div><div class="line">            List&lt;scalar&gt; mu_now(2);</div><div class="line">            Vector&lt;double&gt; Uinl(0, 0, 0);</div><div class="line">            label BCind = 0;</div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (label <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> = 0; <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a> &lt; par.rows(); <a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>++)</div><div class="line">            {</div><div class="line">                Uinl[0] = par(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 0);</div><div class="line">                Uinl[1] = par(<a class="code" href="msrProblem_2pEqn_8H.html#ac23c63c7750d8829a77f4ebe1d961c48">i</a>, 1);</div><div class="line">                <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>(), BCind, Uinl);</div><div class="line">                <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(folder);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(fileName folder)</div><div class="line">        {</div><div class="line">            Time&amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a> = <a class="code" href="classsteadyNS.html#a4493d1f1ce7e2008c85b1dde7c027de4">_runTime</a>();</div><div class="line">            fvMesh&amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a> = <a class="code" href="classsteadyNS.html#a6a233a5c129864684e67e41d04983e01">_mesh</a>();</div><div class="line">            volScalarField&amp; <a class="code" href="classtutorial06.html#a6369844e0ed5847d056a9c3ec5945fe4">p</a> = <a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>();</div><div class="line">            volVectorField&amp; <a class="code" href="classtutorial06.html#a33b6b6be45459eb32c9b86d46c5ef790">U</a> = <a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>();</div><div class="line">            surfaceScalarField&amp; <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> = <a class="code" href="classsteadyNS.html#a27dd336cf3b9757ba406b3d3926ac299">_phi</a>();</div><div class="line">            fv::options&amp; fvOptions = <a name="a50"></a><a class="code" href="classsteadyNS.html#a404c448879353c38f3d3121d6afc1802">_fvOptions</a>();</div><div class="line">            simpleControl&amp; simple = <a class="code" href="classsteadyNS.html#a2eedc2d1f931744a2e2ba785d803eb5f">_simple</a>();</div><div class="line">            IOMRFZoneList&amp; MRF = <a name="a51"></a><a class="code" href="classsteadyNS.html#a99bd483228d60f47cd8ed4ed61a57472">_MRF</a>();</div><div class="line">            singlePhaseTransportModel&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#aaa15f2fa61d58ef55036975f0a15cd3d">laminarTransport</a> = <a name="a52"></a><a class="code" href="classsteadyNS.html#a6a8bb2d446609e075c792818ddefc2ed">_laminarTransport</a>();</div><div class="line"><span class="preprocessor">#include &quot;NLsolve.H&quot;</span></div><div class="line">            <a class="code" href="namespaceITHACAstream.html#a36ae0d53d94f890fdfe72086003eacee">ITHACAstream::exportSolution</a>(<a class="code" href="classtutorial06.html#a33b6b6be45459eb32c9b86d46c5ef790">U</a>, name(<a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>), folder);</div><div class="line">            <a class="code" href="namespaceITHACAstream.html#a36ae0d53d94f890fdfe72086003eacee">ITHACAstream::exportSolution</a>(<a class="code" href="classtutorial06.html#a6369844e0ed5847d056a9c3ec5945fe4">p</a>, name(<a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>), folder);</div><div class="line">            volScalarField <a class="code" href="classSteadyNSTurb.html#a43d6ca286d08b8715a79fbcd1b6ef29d">_nut</a>(<a name="a53"></a><a class="code" href="classsteadyNS.html#aaca30267f4ac8d166f95d08ea674cbfe">turbulence</a>-&gt;nut());</div><div class="line">            <a class="code" href="namespaceITHACAstream.html#a36ae0d53d94f890fdfe72086003eacee">ITHACAstream::exportSolution</a>(<a class="code" href="classSteadyNSTurb.html#a43d6ca286d08b8715a79fbcd1b6ef29d">_nut</a>, name(<a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>), folder);</div><div class="line">            <a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>.append(<a class="code" href="classtutorial06.html#a33b6b6be45459eb32c9b86d46c5ef790">U</a>);</div><div class="line">            <a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>.append(<a class="code" href="classtutorial06.html#a6369844e0ed5847d056a9c3ec5945fe4">p</a>);</div><div class="line">            <a class="code" href="classSteadyNSTurb.html#a4bda4f74c0cf2abe5f4096c663b7a8a8">nutFields</a>.append(<a class="code" href="classSteadyNSTurb.html#a43d6ca286d08b8715a79fbcd1b6ef29d">_nut</a>);</div><div class="line">            <a class="code" href="classsteadyNS.html#a518b61f02646a36cd4a2610446c00b61">counter</a>++;</div><div class="line">        }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a54"></a><a class="code" href="06POD__RBF_8C.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// Construct the tutorial06 object</span></div><div class="line">    <a class="code" href="classtutorial06.html">tutorial06</a> example(argc, argv);</div><div class="line">    <span class="comment">// Read parameters samples for the offline stage and the ones for the online stages</span></div><div class="line">    word par_offline(<span class="stringliteral">&quot;./par_offline&quot;</span>);</div><div class="line">    word par_new(<span class="stringliteral">&quot;./par_online&quot;</span>);</div><div class="line">    Eigen::MatrixXd par_online = <a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_new);</div><div class="line">    example.mu = <a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_offline);</div><div class="line">    <span class="comment">// Set the inlet boundaries where we have parameterized boundary conditions</span></div><div class="line">    example.inletIndex.resize(2, 2);</div><div class="line">    example.inletIndex(0, 0) = 0;</div><div class="line">    example.inletIndex(0, 1) = 0;</div><div class="line">    example.inletIndex(1, 0) = 0;</div><div class="line">    example.inletIndex(1, 1) = 1;</div><div class="line">    <a class="code" href="classITHACAparameters.html">ITHACAparameters</a>* para = <a class="code" href="classITHACAparameters.html#adf4e7e15954b8779d57ed6478a19027f">ITHACAparameters::getInstance</a>(example._mesh(),</div><div class="line">                             example._runTime());</div><div class="line">    <span class="comment">// Read parameters from ITHACAdict file</span></div><div class="line">    <span class="keywordtype">int</span> NmodesU = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesU&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesP = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesP&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUP = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUP&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesNUT = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesNUT&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesProject = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesProject&quot;</span>, 5);</div><div class="line">    <span class="comment">// Perform The Offline Solve;</span></div><div class="line">    example.offlineSolve();</div><div class="line">    <span class="comment">// Read the lift functions</span></div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(example.liftfield, example.U, <span class="stringliteral">&quot;./lift/&quot;</span>);</div><div class="line">    <span class="comment">// Create the homogeneous set of snapshots for the velocity field</span></div><div class="line">    example.computeLift(example.Ufield, example.liftfield, example.Uomfield);</div><div class="line">    <span class="comment">// Export the homogeneous velocity snapshots</span></div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a3dbb939ce5c8b0b3104b07050df0d9cb">ITHACAstream::exportFields</a>(example.Uomfield, <span class="stringliteral">&quot;./ITHACAoutput/Offline&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;Uofield&quot;</span>);</div><div class="line">    <span class="comment">// Perform a POD decomposition for the velocity, the pressure and the eddy viscosity</span></div><div class="line">    <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Uomfield, example.Umodes, example._U().name(),</div><div class="line">                        example.podex,</div><div class="line">                        example.supex, 0, NmodesProject);</div><div class="line">    <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example.p().name(),</div><div class="line">                        example.podex,</div><div class="line">                        example.supex, 0, NmodesProject);</div><div class="line">    <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.nutFields, example.nutModes, example._nut().name(),</div><div class="line">                        example.podex,</div><div class="line">                        example.supex, 0, NmodesProject);</div><div class="line">    <span class="comment">// Solve the supremizer problem based on the pressure modes</span></div><div class="line">    example.solvesupremizer(<span class="stringliteral">&quot;modes&quot;</span>);</div><div class="line">    <span class="comment">// Compute the reduced order matrices</span></div><div class="line">    example.projectSUP(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesU, NmodesP, NmodesSUP,</div><div class="line">                       NmodesNUT);</div><div class="line">    <span class="comment">// Create an object of the turbulent class</span></div><div class="line">    <a name="_a55"></a><a class="code" href="classReducedSteadyNSTurb.html">ReducedSteadyNSTurb</a> pod_rbf(</div><div class="line">        example);</div><div class="line">    <span class="comment">// Set value of the reduced viscosity and the penalty factor</span></div><div class="line">    pod_rbf.nu = 1e-3;</div><div class="line">    pod_rbf.tauU.resize(2, 1);</div><div class="line">    <span class="comment">// We create the matrix rbfCoeff which will store the values of the interpolation results for the eddy viscosity field</span></div><div class="line">    Eigen::MatrixXd rbfCoeff;</div><div class="line">    rbfCoeff.resize(NmodesNUT, par_online.rows());</div><div class="line"></div><div class="line">    <span class="comment">// Perform an online solve for the new values of inlet velocities</span></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; par_online.rows(); k++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd velNow(2, 1);</div><div class="line">        velNow(0, 0) = par_online(k, 0);</div><div class="line">        velNow(1, 0) = par_online(k, 1);</div><div class="line">        pod_rbf.tauU(0, 0) = 0;</div><div class="line">        pod_rbf.tauU(1, 0) = 0;</div><div class="line">        pod_rbf.solveOnlineSUP(velNow);</div><div class="line">        rbfCoeff.col(k) = pod_rbf.rbfCoeff;</div><div class="line">        Eigen::MatrixXd tmp_sol(pod_rbf.y.rows() + 1, 1);</div><div class="line">        tmp_sol(0) = k + 1;</div><div class="line">        tmp_sol.col(0).tail(pod_rbf.y.rows()) = pod_rbf.y;</div><div class="line">        pod_rbf.online_solution.append(tmp_sol);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Save the matrix of interpolated eddy viscosity coefficients</span></div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(rbfCoeff, <span class="stringliteral">&quot;rbfCoeff&quot;</span>, <span class="stringliteral">&quot;python&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/Matrices/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(rbfCoeff, <span class="stringliteral">&quot;rbfCoeff&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/Matrices/&quot;</span>);</div><div class="line">    <span class="comment">// Save the online solution</span></div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_rbf.online_solution, <span class="stringliteral">&quot;red_coeff&quot;</span>, <span class="stringliteral">&quot;python&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeff&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_rbf.online_solution, <span class="stringliteral">&quot;red_coeff&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeff&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_rbf.online_solution, <span class="stringliteral">&quot;red_coeff&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeff&quot;</span>);</div><div class="line">    pod_rbf.rbfCoeffMat = rbfCoeff;</div><div class="line">    <span class="comment">// Reconstruct and export the solution</span></div><div class="line">    pod_rbf.reconstruct(<span class="keyword">true</span>, <span class="stringliteral">&quot;./ITHACAoutput/Reconstruction/&quot;</span>);</div><div class="line">    <span class="comment">// Create an object of the laminar class</span></div><div class="line">    <a class="code" href="classreducedSteadyNS.html">reducedSteadyNS</a> pod_normal(</div><div class="line">        example);</div><div class="line">    <span class="comment">// Set value of the reduced viscosity and the penalty factor</span></div><div class="line">    pod_normal.nu = 1e-3;</div><div class="line">    pod_normal.tauU.resize(2, 1);</div><div class="line"></div><div class="line">    <span class="comment">// Perform an online solve for the new values of inlet velocities</span></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; par_online.rows(); k++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd vel_now(2, 1);</div><div class="line">        vel_now(0, 0) = par_online(k, 0);</div><div class="line">        vel_now(1, 0) = par_online(k, 1);</div><div class="line">        pod_normal.tauU(0, 0) = 0;</div><div class="line">        pod_normal.tauU(1, 0) = 0;</div><div class="line">        pod_normal.solveOnline_sup(vel_now);</div><div class="line">        Eigen::MatrixXd tmp_sol(pod_normal.y.rows() + 1, 1);</div><div class="line">        tmp_sol(0) = k + 1;</div><div class="line">        tmp_sol.col(0).tail(pod_normal.y.rows()) = pod_normal.y;</div><div class="line">        pod_normal.online_solution.append(tmp_sol);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Save the online solution</span></div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_normal.online_solution, <span class="stringliteral">&quot;red_coeffnew&quot;</span>, <span class="stringliteral">&quot;python&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeffnew&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_normal.online_solution, <span class="stringliteral">&quot;red_coeffnew&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeffnew&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(pod_normal.online_solution, <span class="stringliteral">&quot;red_coeffnew&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/red_coeffnew&quot;</span>);</div><div class="line">    <span class="comment">// Reconstruct and export the solution</span></div><div class="line">    pod_normal.reconstruct(<span class="keyword">true</span>, <span class="stringliteral">&quot;./ITHACAoutput/Lam_Rec/&quot;</span>);</div><div class="line">    <span class="comment">// Solve the full order problem for the online velocity values for the purpose of comparison</span></div><div class="line">    <span class="comment">// if (ITHACAutilities::check_folder(&quot;./ITHACAoutput/Offline_check&quot;) == false)</span></div><div class="line">    <span class="comment">// {</span></div><div class="line">    <span class="comment">//     example.offlineSolve(par_online, &quot;./ITHACAoutput/Offline_check/&quot;);</span></div><div class="line">    <span class="comment">//     ITHACAutilities::createSymLink(&quot;./ITHACAoutput/Offline_check&quot;);</span></div><div class="line">    <span class="comment">// }</span></div><div class="line">    Eigen::MatrixXd errFrobU = <a class="code" href="namespaceITHACAutilities.html#ab50e0c5e1738a8ba59182ad433ca140a">ITHACAutilities::errorFrobRel</a>(example.Ufield,</div><div class="line">                               pod_rbf.uRecFields);</div><div class="line">    Eigen::MatrixXd errFrobP =  <a class="code" href="namespaceITHACAutilities.html#ab50e0c5e1738a8ba59182ad433ca140a">ITHACAutilities::errorFrobRel</a>(example.Pfield,</div><div class="line">                                pod_rbf.pRecFields);</div><div class="line">    Eigen::MatrixXd errFrobNut =  <a class="code" href="namespaceITHACAutilities.html#ab50e0c5e1738a8ba59182ad433ca140a">ITHACAutilities::errorFrobRel</a>(example.nutFields,</div><div class="line">                                  pod_rbf.nutRecFields);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errFrobU, <span class="stringliteral">&quot;errFrobU&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsFrob/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errFrobP, <span class="stringliteral">&quot;errFrobP&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsFrob/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errFrobNut, <span class="stringliteral">&quot;errFrobNut&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsFrob/&quot;</span>);</div><div class="line">    Eigen::MatrixXd errL2U = <a class="code" href="namespaceITHACAutilities.html#ac150bf2cd5f5f146a3dba2cb60d2f16a">ITHACAutilities::errorL2Rel</a>(example.Ufield,</div><div class="line">                             pod_rbf.uRecFields);</div><div class="line">    Eigen::MatrixXd errL2P =  <a class="code" href="namespaceITHACAutilities.html#ac150bf2cd5f5f146a3dba2cb60d2f16a">ITHACAutilities::errorL2Rel</a>(example.Pfield,</div><div class="line">                              pod_rbf.pRecFields);</div><div class="line">    Eigen::MatrixXd errL2Nut =  <a class="code" href="namespaceITHACAutilities.html#ac150bf2cd5f5f146a3dba2cb60d2f16a">ITHACAutilities::errorL2Rel</a>(example.nutFields,</div><div class="line">                                pod_rbf.nutRecFields);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errL2U, <span class="stringliteral">&quot;errL2U&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsL2/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errL2P, <span class="stringliteral">&quot;errL2P&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsL2/&quot;</span>);</div><div class="line">    <a class="code" href="namespaceITHACAstream.html#a483b7ea851dae940e8651c1fea9e5def">ITHACAstream::exportMatrix</a>(errL2Nut, <span class="stringliteral">&quot;errL2Nut&quot;</span>, <span class="stringliteral">&quot;matlab&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/ErrorsL2/&quot;</span>);</div><div class="line">    exit(0);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//--------</span></div><div class="line"><span class="comment"></span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
