<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ITHACA-FV: 10unsteadyBB_enclosed.C</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ithaca-fv-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="">ITHACA-FV</a>
   &#160;<span id="projectnumber"><a href="">5.0</a></span>
   </div>
   <div id="projectbrief"><a href="https://mathlab.sissa.it/">SISSA mathLab</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">10unsteadyBB_enclosed.C</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="intro_unsteadyBB"></a>
Introduction to tutorial 10</h1>
<p class="">In this tutorial an unsteady Buoyant Boussinesq (BB) 2D problem with paramerized temperature boundary conditions is implemented. The physical problem represents a differentially heated cavity. A uniform temperature is set to the left (hot) and the right (cold) sides of the cavity while the other sides are set to adiabatic. The cavity aspect ratio is 1.0. The flow is laminar and the working fluid is air with Pr = 0.7. The ambient temperature is 300 K. The hot wall, Th, has a temperature of 301.5 K, while the cold wall, Tc, is set to 298.5 K. The initial condition for the velocity is (0.0001, 0, 0) m/s.</p>
<p class="">The following image illustrates the geometry with the boundary conditions. </p><div class="image">
<img src="setup_diff_heated_cavity.png" alt="setup_diff_heated_cavity.png"/>
</div>
<h1><a class="anchor" id="code04"></a>
A detailed look into the code</h1>
<p class="">In this section we explain the main steps necessary to construct the tutorial NÂ°10</p>
<h2><a class="anchor" id="header"></a>
The necessary header files</h2>
<p class="">First of all let's have a look at the header files that need to be included and what they are responsible for.</p>
<p class="">The header files of ITHACA-FV necessary for this tutorial are: &lt;<a class="el" href="unsteadyBB_8H.html" title="Header file of the unsteadyBB class.">unsteadyBB.H</a>&gt; for the full order unsteady BB problem, &lt;<a class="el" href="ITHACAPOD_8H.html" title="Header file of the ITHACAPOD class.">ITHACAPOD.H</a>&gt; for the POD decomposition, &lt;<a class="el" href="reducedUnsteadyBB_8H.html" title="Header file of the reducedUnsteadyBB class.">reducedUnsteadyBB.H</a>&gt; for the construction of the reduced order problem, and finally &lt;<a class="el" href="ITHACAstream_8H.html" title="Header file of the ITHACAstream class, it contains the implementation of several methods for input ou...">ITHACAstream.H</a>&gt; for some ITHACA input-output operations.</p>
 <p><div class="fragment"><div class="line">    10unsteadyBB_enclosed.C</div><div class="line">\*---------------------------------------------------------------------------*/</div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="unsteadyBB_8H.html">unsteadyBB.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reducedUnsteadyBB_8H.html">reducedUnsteadyBB.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div></div><!-- fragment --></p>
<h2><a class="anchor" id="classtutorial10"></a>
Definition of the tutorial10 class</h2>
<p class="">We define the <a class="el" href="classtutorial10.html">tutorial10</a> class as a child of the <a class="el" href="classunsteadyBB.html" title="Implementation of a parametrized full order  unsteady Boussinesq problem  and preparation of the the ...">unsteadyBB</a> class. The constructor is defined with members that are the fields need to be manipulated during the resolution of the full order problem using the BuoyancyBoussinesqPimpleFoam solver. Such fields are also initialized with the same initial conditions in the solver. <p><div class="fragment"><div class="line"><span class="keyword">class </span><a name="_a0"></a><a class="code" href="classtutorial10.html">tutorial10</a>: <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="classunsteadyBB.html">unsteadyBB</a></div><div class="line">{</div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">explicit</span> <a name="a2"></a><a class="code" href="classtutorial10.html#a5e22e7a4d5396566191d8301cc66900d">tutorial10</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">            :</div><div class="line">            <a name="a3"></a><a class="code" href="classunsteadyBB.html#a4b0135c71b2cc89cb86a02292ee16f7f">unsteadyBB</a>(argc, argv),</div><div class="line">            <a name="a4"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2steadyNS_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>(<a name="a5"></a><a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div><div class="line">            <a name="a6"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2steadyNS_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>(<a name="a7"></a><a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>()),</div><div class="line">            <a name="a8"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#a078488f2d744d7aa2b747a322270c1e5">p_rgh</a>(<a name="a9"></a><a class="code" href="classunsteadyBB.html#a30c3bcc294ff7220768155a7680ec58e">_p_rgh</a>()),</div><div class="line">            <a name="a10"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>(<a name="a11"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#a15d920713a31c7f6fa105e0ab1e5085a">_T</a>())</div><div class="line">        {}</div></div><!-- fragment --></p>
<p class="">Inside the <a class="el" href="classtutorial10.html">tutorial10</a> class we define the offlineSolve method according to the specific parametrized problem that needs to be solved. If the offline solve has been previously performed then the method simply reads in the existing snapshots from the Offline directory. If not, the offlineSolve changes the values of the temperature boundary conditions before performing the offline solve.</p>
<p class=""><p><div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a name="a12"></a><a class="code" href="classtutorial10.html#aaf68ea5b687884c6ca4c90354b5c8256">offlineSolve</a>(Eigen::MatrixXd par_BC)</div><div class="line">        {</div><div class="line">            List&lt;scalar&gt; mu_now(1);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (<a name="a13"></a><a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div><div class="line">            {</div><div class="line">                <a name="a14"></a><a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a name="a15"></a><a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2steadyNS_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                <a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a name="a16"></a><a class="code" href="classunsteadyBB.html#a1806a026547d8bdd80449d4f6d0b3391">Tfield</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">for</span> (label k = 0; k &lt; par_BC.rows(); k++)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">for</span> (label j = 0; j &lt; par_BC.cols(); j++)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">for</span> (label <a name="a17"></a><a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a name="a18"></a><a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.cols(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">                        {</div><div class="line">                            mu_now[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line">                        }</div><div class="line">                        <a name="a19"></a><a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>, <a name="a20"></a><a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>(j, 0), par_BC(k, j));</div><div class="line">                    }</div><div class="line">                    <a name="a21"></a><a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(mu_now);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div></div><!-- fragment --></p>
<p class="">In order to calculate the L2 error between the online solved reduced order model and the corresponding full order solution at the end of this tutorial, the full order solve can be performed with the onlineSolveFull for a parameter set for which the reduced order model has been solved online.</p>
<p class=""><p><div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a name="a22"></a><a class="code" href="classtutorial10.html#a95e681cc6dfbfcf89f66ad2dce57eef4">onlineSolveFull</a>(Eigen::MatrixXd par_BC, label para_set_BC, fileName folder)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a name="a23"></a><a class="code" href="classITHACAutilities.html#ab78c0aa3c357eda38145f79ad75db08a">ITHACAutilities::check_folder</a>(folder))</div><div class="line">            {</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                mkDir(folder);</div><div class="line">                <a name="a24"></a><a class="code" href="classITHACAutilities.html#ac173a99f791d60b33f48a9971946d4cd">ITHACAutilities::createSymLink</a>(folder);</div><div class="line">                label <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = para_set_BC;</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (label j = 0; j &lt; par_BC.cols(); j++)</div><div class="line">                {</div><div class="line">                    <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>, <a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>(j, 0), par_BC(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, j));</div><div class="line">                }</div><div class="line">                <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(folder);</div><div class="line">            }</div><div class="line">        }</div></div><!-- fragment --></p>
<p class="">If the full order solve has been performed previously then the existing snapshots can be read in from the specified directory.</p>
<p class=""><p><div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a name="a25"></a><a class="code" href="classtutorial10.html#a237599f617a954c3ffa426a4c99a88f1">onlineSolveRead</a>(fileName folder)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classITHACAutilities.html#ab78c0aa3c357eda38145f79ad75db08a">ITHACAutilities::check_folder</a>(folder))</div><div class="line">            {</div><div class="line">                <a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a name="a26"></a><a class="code" href="classunsteadyBB.html#a4988642ce391c8bd317f822bcff39b82">Ufield_on</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2steadyNS_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>, folder);</div><div class="line">                <a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a name="a27"></a><a class="code" href="classunsteadyBB.html#a6e79983a4b154e45f70f29baeda8e0cc">Tfield_on</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>, folder);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">            }</div><div class="line">        }</div></div><!-- fragment --></p>
<p class="">The liftingfunctions for temperature in this problem are determined by solving a steady state laplacian function</p>
<p class=""><p><div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a name="a28"></a><a class="code" href="classtutorial10.html#a123c0d6af5a9ff009a17c523a6fdaa1d">liftSolveT</a>()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">for</span> (label k = 0; k &lt; <a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>.rows(); k++)</div><div class="line">            {</div><div class="line">                Time&amp; <a name="a29"></a><a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a> = <a name="a30"></a><a class="code" href="classsteadyNS.html#a4493d1f1ce7e2008c85b1dde7c027de4">_runTime</a>();</div><div class="line">                fvMesh&amp; <a name="a31"></a><a class="code" href="laplacianProblem_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a> = <a name="a32"></a><a class="code" href="classunsteadyBB.html#affc7179ddcd50444fa5bd8112955fdf9">_mesh</a>();</div><div class="line">                volScalarField <a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a> = <a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#a15d920713a31c7f6fa105e0ab1e5085a">_T</a>();</div><div class="line">                simpleControl simple(<a class="code" href="laplacianProblem_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>);</div><div class="line">                volScalarField&amp; <a name="a33"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a> = <a name="a34"></a><a class="code" href="classunsteadyBB.html#af5eb28bf9a1f22d1faf36beaaffb4322">_alphat</a>();</div><div class="line">                dimensionedScalar&amp; <a name="a35"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#aaa2bcdf60b963df524d7a8dbaa3c69d1">Pr</a> = <a name="a36"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#a6bfc16bb9323732dd926a5ca767a14b4">_Pr</a>();</div><div class="line">                dimensionedScalar&amp; <a name="a37"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#a8dc4ce5b8c2b169e7d3d5a449fb5f245">Prt</a> = <a name="a38"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#ad154c47b50b98189477fb9b72fd7b151">_Prt</a>();</div><div class="line">                label BCind = <a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>(k, 0);</div><div class="line">                volScalarField Tlift(<span class="stringliteral">&quot;Tlift&quot;</span> + name(k), <a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>);</div><div class="line">                instantList Times = <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.times();</div><div class="line">                <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.setTime(Times[1], 1);</div><div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Solving a lifting Problem&quot;</span> &lt;&lt; endl;</div><div class="line">                scalar t1 = 1;</div><div class="line">                scalar t0 = 0;</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (label j = 0; j &lt; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>.boundaryField().size(); j++)</div><div class="line">                {</div><div class="line">                    <a name="a39"></a><a class="code" href="classreductionProblem.html#a5c9c99f98e576423c196093a72e2ce98">assignIF</a>(Tlift, t0);</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> (j == BCind)</div><div class="line">                    {</div><div class="line">                        <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(Tlift, j, t1);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="src_2ITHACA__FOMPROBLEMS_2laplacianProblem_2createFields_8H.html#ab35c96e5601691f7270cfadc745a12d3">T</a>.boundaryField()[BCind].type() == <span class="stringliteral">&quot;fixedValue&quot;</span>)</div><div class="line">                    {</div><div class="line">                        <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(Tlift, j, t0);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">while</span> (simple.correctNonOrthogonal())</div><div class="line">                {</div><div class="line">                    <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a> = <a name="a40"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2steadyNS_2createFields_8H.html#a7eb708ed6afd5d2b8cec73f71e0ff2d4">turbulence</a>-&gt;nut() / <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#a8dc4ce5b8c2b169e7d3d5a449fb5f245">Prt</a>;</div><div class="line">                    <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a>.correctBoundaryConditions();</div><div class="line">                    volScalarField <a name="a41"></a><a class="code" href="unsteadyBB_2TEqn_8H.html#a603f2c2d151fcc6207de76c4a474a83d">alphaEff</a>(<span class="stringliteral">&quot;alphaEff&quot;</span>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2steadyNS_2createFields_8H.html#a7eb708ed6afd5d2b8cec73f71e0ff2d4">turbulence</a>-&gt;nu() / <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#aaa2bcdf60b963df524d7a8dbaa3c69d1">Pr</a> + <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a>);</div><div class="line">                    fvScalarMatrix <a name="a42"></a><a class="code" href="unsteadyBB_2TEqn_8H.html#a1b8e008a9511be220d3ef4fdf9430123">TEqn</a></div><div class="line">                    (</div><div class="line">                        fvm::laplacian(<a class="code" href="unsteadyBB_2TEqn_8H.html#a603f2c2d151fcc6207de76c4a474a83d">alphaEff</a>, Tlift)</div><div class="line">                    );</div><div class="line">                    <a class="code" href="unsteadyBB_2TEqn_8H.html#a1b8e008a9511be220d3ef4fdf9430123">TEqn</a>.solve();</div><div class="line">                    Info &lt;&lt; <span class="stringliteral">&quot;ExecutionTime = &quot;</span> &lt;&lt; <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.elapsedCpuTime() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span></div><div class="line">                         &lt;&lt; <span class="stringliteral">&quot;  ClockTime = &quot;</span> &lt;&lt; <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.elapsedClockTime() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span></div><div class="line">                         &lt;&lt; nl &lt;&lt; endl;</div><div class="line">                }</div><div class="line"></div><div class="line">                Tlift.write();</div><div class="line">                <a name="a43"></a><a class="code" href="classunsteadyBB.html#a2cd16c474cf84f9318e534ebb46d5a70">liftfieldT</a>.append(Tlift);</div><div class="line">            }</div><div class="line">        }</div></div><!-- fragment --></p>
<h2><a class="anchor" id="main"></a>
Definition of the main function</h2>
<p class="">In this section we show the definition of the main function. First we construct the object "example" of type <a class="el" href="classtutorial10.html">tutorial10</a>:</p>
<p class=""><div class="fragment"><div class="line">    <a class="code" href="classtutorial10.html">tutorial10</a> example(argc, argv);</div></div><!-- fragment --></p>
<p class="">The parameter sets for the temperature BC are read in from file, both for the offline and online phase. Each row corresponds to a parameter set and each column to a specific boundary.</p>
<p class=""><p><div class="fragment"><div class="line">    word par_offline_BC(<span class="stringliteral">&quot;./par_offline_BC&quot;</span>);</div><div class="line">    Eigen::MatrixXd par_off_BC = <a name="a44"></a><a class="code" href="classITHACAstream.html#a1b1605dfbed6b82596cbf7749dd6b182">ITHACAstream::readMatrix</a>(par_offline_BC);</div><div class="line">    word par_online_BC(<span class="stringliteral">&quot;./par_online_BC&quot;</span>);</div><div class="line">    Eigen::MatrixXd par_on_BC = <a class="code" href="classITHACAstream.html#a1b1605dfbed6b82596cbf7749dd6b182">ITHACAstream::readMatrix</a>(par_online_BC);</div></div><!-- fragment --></p>
<p class="">Then we parse the ITHACAdict file to determine the number of modes to be written out and also the ones to be used for projection of the velocity, pressure, temperature and the supremizer: <p><div class="fragment"><div class="line">    <a name="_a45"></a><a class="code" href="classITHACAparameters.html">ITHACAparameters</a> <a name="a46"></a><a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>;</div><div class="line">    <span class="keywordtype">int</span> NmodesUproj   = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>.<a name="a47"></a><a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesPproj   = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesTproj   = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesTproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUPproj = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesOut     = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesOut&quot;</span>, 15);</div></div><!-- fragment --></p>
<p class="">We note that a default value can be assigned in case the parser did not find the corresponding string in the ITHACAdict file.</p>
<p class="">Now the kinematic viscosity is set to 0.00001 m^2/s. It is possible to parametrize the viscosity. For more info take a look at <a class="el" href="classtutorial04.html">tutorial04</a>.</p>
<p class=""><p><div class="fragment"><div class="line">    example.Pnumber = 1;</div><div class="line">    example.Tnumber = 1;</div><div class="line">    example.setParameters();</div><div class="line">    example.mu_range(0, 0) = 0.00001;</div><div class="line">    example.mu_range(0, 1) = 0.00001;</div><div class="line">    <span class="comment">// Generate equispaced samples inside the parameter range</span></div><div class="line">    example.genEquiPar();</div></div><!-- fragment --></p>
<p class="">After that we set the boundaries where we have a non homogeneous BC for temperature. Patch 1 corresponds to the hot boundary and Patch 2 to the cold boundary.</p>
<p class=""><p><div class="fragment"><div class="line">    example.inletIndexT.resize(2, 1);</div><div class="line">    example.inletIndexT &lt;&lt; 1, 2;</div></div><!-- fragment --></p>
<p class="">Furthermore, we set the parameters for the time integration. In this case the simulation time is 10 seconds, with a step size = 0.005 seconds, and the data is written every 0.01 seconds, i.e.</p>
<p class=""><p><div class="fragment"><div class="line">    example.startTime = 0.0;</div><div class="line">    example.finalTime = 10.0;</div><div class="line">    example.timeStep = 0.005;</div><div class="line">    example.writeEvery = 0.01;</div></div><!-- fragment --></p>
<p class="">Now we are ready to perform the offline stage:</p>
<p class=""><div class="fragment"><div class="line">    example.offlineSolve(par_off_BC);</div></div><!-- fragment --></p>
<p class="">No lifting function has to be computed for velocity as the velocity is zero everywhere on the boundary. For the temperature, the lifting functions are determined by:</p>
<p class=""><div class="fragment"><div class="line">    example.liftSolveT();</div></div><!-- fragment --></p>
<p class="">Then we create homogenuous basis functions for the temperature:</p>
<p class=""><div class="fragment"><div class="line">    example.computeLiftT(example.Tfield, example.liftfieldT, example.Tomfield);</div></div><!-- fragment --></p>
<p class="">And after that, we obtain the modes for velocity and temperature:</p>
<p class=""><p><div class="fragment"><div class="line">    <a name="a48"></a><a class="code" href="classITHACAPOD.html#a793c3cc7d50f7ecb66a5b964b2e3b12c">ITHACAPOD::getModes</a>(example.Ufield, example.Umodes, example.podex, 0, 0,</div><div class="line">    <a class="code" href="classITHACAPOD.html#a793c3cc7d50f7ecb66a5b964b2e3b12c">ITHACAPOD::getModes</a>(example.Tomfield, example.Tmodes, example.podex, 0, 0,</div></div><!-- fragment --></p>
<p class="">Before continuiting, the projection error is calculated for certain number of modes for both temperature and velocity.</p>
<p class=""><p><div class="fragment"><div class="line">    Eigen::MatrixXd List_of_modes(NmodesOut - 5, 1);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; List_of_modes.rows(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">    {</div><div class="line">        List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) = <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1;</div><div class="line">    }</div><div class="line">    <a name="a49"></a><a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(List_of_modes, <span class="stringliteral">&quot;List_of_modes&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div></div><!-- fragment --></p>
<p class="">The temperature modes are created locally</p>
<p class=""><p><div class="fragment"><div class="line">    PtrList&lt;volScalarField&gt; TLmodes;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; example.liftfieldT.size(); k++)</div><div class="line">    {</div><div class="line">        TLmodes.append(example.liftfieldT[k]);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; List_of_modes.size(); k++)</div><div class="line">    {</div><div class="line">        TLmodes.append(example.Tmodes[k]);</div><div class="line">    }</div></div><!-- fragment --></p>
<p class="">and the projection onto the POD modes is performed with:</p>
<p class=""><p><div class="fragment"><div class="line">    Eigen::MatrixXd L2errorProjMatrixU(example.Ufield.size(), List_of_modes.rows());</div><div class="line">    Eigen::MatrixXd L2errorProjMatrixT(example.Tfield.size(), List_of_modes.rows());</div></div><!-- fragment --></p>
<p class="">Finally the L2 error between full order solution and projection of the basis are calculated <p><div class="fragment"><div class="line">    <span class="comment">// Calculate the coefficients and L2 error and store the error in a matrix for each number of modes</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; List_of_modes.rows(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd coeffU = <a name="a50"></a><a class="code" href="classITHACAutilities.html#a0e7190e72e1e77eac058bcc788e364a2">ITHACAutilities::get_coeffs</a>(example.Ufield,</div><div class="line">                                 example.Umodes,</div><div class="line">                                 List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) + example.liftfield.size() + NmodesSUPproj);</div><div class="line">        Eigen::MatrixXd coeffT = <a class="code" href="classITHACAutilities.html#a0e7190e72e1e77eac058bcc788e364a2">ITHACAutilities::get_coeffs</a>(example.Tfield, TLmodes,</div><div class="line">                                 List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) + example.liftfieldT.size());</div><div class="line">        PtrList&lt;volVectorField&gt; rec_fieldU = <a name="a51"></a><a class="code" href="classITHACAutilities.html#a1b47e1c037adb60976a0ceff805cad32">ITHACAutilities::reconstruct_from_coeff</a>(</div><div class="line">                example.Umodes, coeffU, List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0));</div><div class="line">        PtrList&lt;volScalarField&gt; rec_fieldT = <a class="code" href="classITHACAutilities.html#a1b47e1c037adb60976a0ceff805cad32">ITHACAutilities::reconstruct_from_coeff</a>(</div><div class="line">                TLmodes, coeffT, List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) + example.liftfieldT.size());</div><div class="line">        Eigen::MatrixXd L2errorProjU = <a name="a52"></a><a class="code" href="classITHACAutilities.html#a67a0fefc2a1ce68ee3cc26aef1dd4b6f">ITHACAutilities::error_listfields</a>(example.Ufield,</div><div class="line">                                       rec_fieldU);</div><div class="line">        Eigen::MatrixXd L2errorProjT = <a class="code" href="classITHACAutilities.html#a67a0fefc2a1ce68ee3cc26aef1dd4b6f">ITHACAutilities::error_listfields</a>(example.Tfield,</div><div class="line">                                       rec_fieldT);</div><div class="line">        L2errorProjMatrixU.col(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>) = L2errorProjU;</div><div class="line">        L2errorProjMatrixT.col(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>) = L2errorProjT;</div><div class="line">    }</div></div><!-- fragment --></p>
<p class="">and exported</p>
<p class=""><p><div class="fragment"><div class="line">    <a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(L2errorProjMatrixU, <span class="stringliteral">&quot;L2errorProjMatrixU&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/l2error&quot;</span>);</div><div class="line">    <a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(L2errorProjMatrixT, <span class="stringliteral">&quot;L2errorProjMatrixT&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/l2error&quot;</span>);</div></div><!-- fragment --></p>
<p class="">Then the projection onto the POD modes is performed to get the reduced matrices</p>
<p class=""><p><div class="fragment"><div class="line">    example.projectSUP(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesUproj, NmodesPproj, NmodesTproj,</div><div class="line">                       NmodesSUPproj);</div></div><!-- fragment --></p>
<p class="">and the modes are resized to the number for which the projection has been performed</p>
<p class=""><p><div class="fragment"><div class="line">    example.Tmodes.resize(NmodesTproj);</div><div class="line">    example.Umodes.resize(NmodesUproj);</div></div><!-- fragment --></p>
<p class="">Now that we obtained all the necessary information from the POD decomposition and the reduced matrices, we are ready to construct the dynamical system for the reduced order model (ROM). We proceed by constructing the object "reduced" of type <a class="el" href="classreducedUnsteadyBB.html" title="Class where it is implemented a reduced problem for the  unsteady Navier-stokes  problem.">reducedUnsteadyBB</a>:</p>
<p class=""><div class="fragment"><div class="line">    <a name="_a53"></a><a class="code" href="classreducedUnsteadyBB.html">reducedUnsteadyBB</a> reduced(example);</div></div><!-- fragment --></p>
<p class="">We can use the new constructed ROM to perform the online procedure, from which we can simulate the problem at new set of parameters. For instance, we solve the problem for 10 seconds of physical time:</p>
<p class=""><p><div class="fragment"><div class="line">    reduced.nu = 0.00001;</div><div class="line">    reduced.Pr = 0.71;</div><div class="line">    reduced.tstart = 0.0;</div><div class="line">    reduced.finalTime = 10;</div><div class="line">    reduced.dt = 0.005;</div></div><!-- fragment --></p>
<p class="">And then we can use the new constructed ROM to perform the online procedure, from which we can simulate the problem at new set of parameters. As the velocity is homogenous on the boundary, it is not parametrized and therefore an empty matrix is created:</p>
<p class=""><div class="fragment"><div class="line">    Eigen::MatrixXd vel_now_BC(0, 0);</div></div><!-- fragment --></p>
<p class="">Lastly the online procedure is performed for all temperature boundary sets as defined in the par_online_BC file. And he ROM solution is reconstructed and exported:</p>
<p class=""><p><div class="fragment"><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; (par_on_BC.rows()); k++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd temp_now_BC(2, 1);</div><div class="line">        temp_now_BC(0, 0) = par_on_BC(k, 0);</div><div class="line">        temp_now_BC(1, 0) = par_on_BC(k, 1);</div><div class="line">        reduced.solveOnline_sup(temp_now_BC, vel_now_BC, k, par_on_BC.rows());</div><div class="line">        reduced.reconstruct_sup(<span class="stringliteral">&quot;./ITHACAoutput/ReconstructionSUP&quot;</span>, 2);</div><div class="line">    }</div></div><!-- fragment --></p>
<p class="">For the second and third parameter set the full order solution is calculated</p>
<p class=""><p><div class="fragment"><div class="line">    <span class="comment">// Performing full order simulation for second parameter set - temp_BC</span></div><div class="line">    <a class="code" href="classtutorial10.html">tutorial10</a> HFonline2(argc, argv);</div><div class="line">    HFonline2.Pnumber = 1;</div><div class="line">    HFonline2.Tnumber = 1;</div><div class="line">    HFonline2.setParameters();</div><div class="line">    HFonline2.mu_range(0, 0) = 0.00001;</div><div class="line">    HFonline2.mu_range(0, 1) = 0.00001;</div><div class="line">    HFonline2.genEquiPar();</div><div class="line">    HFonline2.inletIndexT.resize(2, 1);</div><div class="line">    HFonline2.inletIndexT &lt;&lt; 1, 2;</div><div class="line">    HFonline2.startTime = 0.0;</div><div class="line">    HFonline2.finalTime = 10;</div><div class="line">    HFonline2.timeStep = 0.005;</div><div class="line">    HFonline2.writeEvery = 0.01;</div><div class="line">    <span class="comment">// Reconstruct the online solution</span></div><div class="line">    HFonline2.onlineSolveFull(par_on_BC, 1,</div><div class="line">                              <span class="stringliteral">&quot;./ITHACAoutput/HFonline2&quot;</span>);</div><div class="line">    <span class="comment">// Performing full order simulation for third parameter set - temp_BC</span></div><div class="line">    <a class="code" href="classtutorial10.html">tutorial10</a> HFonline3(argc, argv);</div><div class="line">    HFonline3.Pnumber = 1;</div><div class="line">    HFonline3.Tnumber = 1;</div><div class="line">    HFonline3.setParameters();</div><div class="line">    HFonline3.mu_range(0, 0) = 0.00001;</div><div class="line">    HFonline3.mu_range(0, 1) = 0.00001;</div><div class="line">    HFonline3.genEquiPar();</div><div class="line">    HFonline3.inletIndexT.resize(2, 1);</div><div class="line">    HFonline3.inletIndexT &lt;&lt; 1, 2;</div><div class="line">    HFonline3.startTime = 0.0;</div><div class="line">    HFonline3.finalTime = 10.0;</div><div class="line">    HFonline3.timeStep = 0.005;</div><div class="line">    HFonline3.writeEvery = 0.01;</div><div class="line">    <span class="comment">// Reconstruct the online solution</span></div><div class="line">    HFonline3.onlineSolveFull(par_on_BC, 2,</div><div class="line">                              <span class="stringliteral">&quot;./ITHACAoutput/HFonline3&quot;</span>);</div><div class="line">    <span class="comment">// Reading in the high-fidelity solutions for the parameter set</span></div><div class="line">    <span class="comment">// for which the offline solve has been performed</span></div><div class="line">    example.onlineSolveRead(<span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">    <span class="comment">// Reading in the high-fidelity solutions for the second parameter set</span></div><div class="line">    example.onlineSolveRead(<span class="stringliteral">&quot;./ITHACAoutput/HFonline2/&quot;</span>);</div><div class="line">    <span class="comment">// Reading in the high-fidelity solutions for the second parameter set</span></div><div class="line">    example.onlineSolveRead(<span class="stringliteral">&quot;./ITHACAoutput/HFonline3/&quot;</span>);</div></div><!-- fragment --></p>
<p class="">and the solutions are read in: <p><div class="fragment"><div class="line"><span class="comment">/// \skipline example.onlineSolveRead(&quot;./ITHACAoutput/Offline/&quot;);</span></div><div class="line"><span class="comment">/// \until example.onlineSolveRead(&quot;./ITHACAoutput/HFonline3/&quot;);</span></div></div><!-- fragment --></p>
<p class="">Finally the L2 error between full and reduced order solutions is calculated</p>
<p class=""><p><div class="fragment"><div class="line"><span class="comment">/// \skipline Ufield_on</span></div><div class="line"><span class="comment">/// \until Tfield_on</span></div><div class="line"><span class="comment">/// \skipline L2errorMatrixU</span></div><div class="line"><span class="comment">/// \until L2errorMatrixT</span></div><div class="line"><span class="comment">/// \skipline &quot;./ITHACAoutput/l2error&quot;);</span></div></div><!-- fragment --></p>
<h1><a class="anchor" id="plaincode"></a>
The plain program</h1>
<p class="">Here's the plain code</p>
<div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div><div class="line"><span class="comment">Copyright (C) 2017 by the ITHACA-FV authors</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">License</span></div><div class="line"><span class="comment">    This file is part of ITHACA-FV</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    ITHACA-FV is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment">    it under the terms of the GNU Lesser General Public License as published by</span></div><div class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><span class="comment">    (at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    ITHACA-FV is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><span class="comment">    GNU Lesser General Public License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    You should have received a copy of the GNU Lesser General Public License</span></div><div class="line"><span class="comment">    along with ITHACA-FV. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Description</span></div><div class="line"><span class="comment">    Example of Boussinesq approximation for two way coupling NS-momentum equation</span></div><div class="line"><span class="comment">    and heat transport equation for enclosed flows.</span></div><div class="line"><span class="comment">SourceFiles</span></div><div class="line"><span class="comment">    10unsteadyBB_enclosed.C</span></div><div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="unsteadyBB_8H.html">unsteadyBB.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reducedUnsteadyBB_8H.html">reducedUnsteadyBB.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classtutorial10.html">tutorial10</a>: <span class="keyword">public</span> <a class="code" href="classunsteadyBB.html">unsteadyBB</a></div><div class="line">{</div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        <span class="keyword">explicit</span> <a class="code" href="classtutorial10.html#a5e22e7a4d5396566191d8301cc66900d">tutorial10</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">            :</div><div class="line">            <a class="code" href="classunsteadyBB.html#a4b0135c71b2cc89cb86a02292ee16f7f">unsteadyBB</a>(argc, argv),</div><div class="line">            <a name="a54"></a><a class="code" href="classtutorial10.html#add89eabb9289b117330adef0a262ff11">U</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div><div class="line">            <a name="a55"></a><a class="code" href="classtutorial10.html#a1636fbc7944743d2d9cf9fb9689588fd">p</a>(<a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>()),</div><div class="line">            <a name="a56"></a><a class="code" href="classtutorial10.html#a8e8c8b4550feb0d558a449ede2fcdedc">p_rgh</a>(<a class="code" href="classunsteadyBB.html#a30c3bcc294ff7220768155a7680ec58e">_p_rgh</a>()),</div><div class="line">            <a name="a57"></a><a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>(<a name="a58"></a><a class="code" href="classunsteadyBB.html#a87011f3b8cc9f3e48bd61d439caf3a9b">_T</a>())</div><div class="line">        {}</div><div class="line"></div><div class="line">        <span class="comment">// Fields To Perform</span></div><div class="line">        volVectorField&amp; <a class="code" href="classtutorial10.html#add89eabb9289b117330adef0a262ff11">U</a>;</div><div class="line">        volScalarField&amp; <a class="code" href="classtutorial10.html#a1636fbc7944743d2d9cf9fb9689588fd">p</a>;</div><div class="line">        volScalarField&amp; <a class="code" href="classtutorial10.html#a8e8c8b4550feb0d558a449ede2fcdedc">p_rgh</a>;</div><div class="line">        volScalarField&amp; <a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>;</div><div class="line"></div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial10.html#aaf68ea5b687884c6ca4c90354b5c8256">offlineSolve</a>(Eigen::MatrixXd par_BC)</div><div class="line">        {</div><div class="line">            List&lt;scalar&gt; mu_now(1);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="classtutorial10.html#add89eabb9289b117330adef0a262ff11">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">                <a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a class="code" href="classunsteadyBB.html#a1806a026547d8bdd80449d4f6d0b3391">Tfield</a>, <a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">for</span> (label k = 0; k &lt; par_BC.rows(); k++)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">for</span> (label j = 0; j &lt; par_BC.cols(); j++)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">for</span> (label <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.cols(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">                        {</div><div class="line">                            mu_now[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line">                        }</div><div class="line"></div><div class="line">                        <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(<a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>, <a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>(j, 0), par_BC(k, j));</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(mu_now);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial10.html#a95e681cc6dfbfcf89f66ad2dce57eef4">onlineSolveFull</a>(Eigen::MatrixXd par_BC, label para_set_BC, fileName folder)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classITHACAutilities.html#ab78c0aa3c357eda38145f79ad75db08a">ITHACAutilities::check_folder</a>(folder))</div><div class="line">            {</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                mkDir(folder);</div><div class="line">                <a class="code" href="classITHACAutilities.html#ac173a99f791d60b33f48a9971946d4cd">ITHACAutilities::createSymLink</a>(folder);</div><div class="line">                label <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = para_set_BC;</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (label j = 0; j &lt; par_BC.cols(); j++)</div><div class="line">                {</div><div class="line">                    <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(<a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>, <a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>(j, 0), par_BC(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, j));</div><div class="line">                }</div><div class="line"></div><div class="line">                <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(folder);</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial10.html#a237599f617a954c3ffa426a4c99a88f1">onlineSolveRead</a>(fileName folder)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classITHACAutilities.html#ab78c0aa3c357eda38145f79ad75db08a">ITHACAutilities::check_folder</a>(folder))</div><div class="line">            {</div><div class="line">                <a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a class="code" href="classunsteadyBB.html#a4988642ce391c8bd317f822bcff39b82">Ufield_on</a>, <a class="code" href="classtutorial10.html#add89eabb9289b117330adef0a262ff11">U</a>, folder);</div><div class="line">                <a class="code" href="classITHACAstream.html#afbe538c82e760d503e3232a52fdd57bb">ITHACAstream::read_fields</a>(<a class="code" href="classunsteadyBB.html#a6e79983a4b154e45f70f29baeda8e0cc">Tfield_on</a>, <a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>, folder);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Method to compute the lifting function for temperature</span></div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial10.html#a123c0d6af5a9ff009a17c523a6fdaa1d">liftSolveT</a>()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">for</span> (label k = 0; k &lt; <a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>.rows(); k++)</div><div class="line">            {</div><div class="line">                Time&amp; <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a> = <a class="code" href="classsteadyNS.html#a4493d1f1ce7e2008c85b1dde7c027de4">_runTime</a>();</div><div class="line">                fvMesh&amp; <a class="code" href="laplacianProblem_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a> = <a class="code" href="classunsteadyBB.html#affc7179ddcd50444fa5bd8112955fdf9">_mesh</a>();</div><div class="line">                volScalarField <a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a> = <a class="code" href="classunsteadyBB.html#a87011f3b8cc9f3e48bd61d439caf3a9b">_T</a>();</div><div class="line">                simpleControl simple(<a class="code" href="laplacianProblem_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>);</div><div class="line">                volScalarField&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a> = <a class="code" href="classunsteadyBB.html#af5eb28bf9a1f22d1faf36beaaffb4322">_alphat</a>();</div><div class="line">                dimensionedScalar&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#aaa2bcdf60b963df524d7a8dbaa3c69d1">Pr</a> = <a name="a59"></a><a class="code" href="classunsteadyBB.html#ab90cd21699a9e1af7e5ada698fc63313">_Pr</a>();</div><div class="line">                dimensionedScalar&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#a8dc4ce5b8c2b169e7d3d5a449fb5f245">Prt</a> = <a name="a60"></a><a class="code" href="classunsteadyBB.html#afbc263a28a2f010cc86e0b0b52562c11">_Prt</a>();</div><div class="line">                label BCind = <a class="code" href="classreductionProblem.html#a06749e2d7072b18b2683df4b4b229539">inletIndexT</a>(k, 0);</div><div class="line">                volScalarField Tlift(<span class="stringliteral">&quot;Tlift&quot;</span> + name(k), <a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>);</div><div class="line">                instantList Times = <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.times();</div><div class="line">                <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.setTime(Times[1], 1);</div><div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Solving a lifting Problem&quot;</span> &lt;&lt; endl;</div><div class="line">                scalar t1 = 1;</div><div class="line">                scalar t0 = 0;</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (label j = 0; j &lt; <a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>.boundaryField().size(); j++)</div><div class="line">                {</div><div class="line">                    <a class="code" href="classreductionProblem.html#a5c9c99f98e576423c196093a72e2ce98">assignIF</a>(Tlift, t0);</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> (j == BCind)</div><div class="line">                    {</div><div class="line">                        <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(Tlift, j, t1);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtutorial10.html#a674416c0e00e0b27f5fe822a06b05694">T</a>.boundaryField()[BCind].type() == <span class="stringliteral">&quot;fixedValue&quot;</span>)</div><div class="line">                    {</div><div class="line">                        <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(Tlift, j, t0);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">while</span> (simple.correctNonOrthogonal())</div><div class="line">                {</div><div class="line">                    <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a> = <a name="a61"></a><a class="code" href="classunsteadyNS.html#a4814163617149be2b0d33515dcb96ec4">turbulence</a>-&gt;nut() / <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#a8dc4ce5b8c2b169e7d3d5a449fb5f245">Prt</a>;</div><div class="line">                    <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a>.correctBoundaryConditions();</div><div class="line">                    volScalarField <a class="code" href="unsteadyBB_2TEqn_8H.html#a603f2c2d151fcc6207de76c4a474a83d">alphaEff</a>(<span class="stringliteral">&quot;alphaEff&quot;</span>, <a class="code" href="classunsteadyNS.html#a4814163617149be2b0d33515dcb96ec4">turbulence</a>-&gt;nu() / <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#aaa2bcdf60b963df524d7a8dbaa3c69d1">Pr</a> + <a class="code" href="src_2ITHACA__FOMPROBLEMS_2unsteadyBB_2createFields_8H.html#abdcf0c0691d6d9f9aefafb8834c3fbe4">alphat</a>);</div><div class="line">                    fvScalarMatrix <a class="code" href="unsteadyBB_2TEqn_8H.html#a1b8e008a9511be220d3ef4fdf9430123">TEqn</a></div><div class="line">                    (</div><div class="line">                        fvm::laplacian(<a class="code" href="unsteadyBB_2TEqn_8H.html#a603f2c2d151fcc6207de76c4a474a83d">alphaEff</a>, Tlift)</div><div class="line">                    );</div><div class="line">                    <a class="code" href="unsteadyBB_2TEqn_8H.html#a1b8e008a9511be220d3ef4fdf9430123">TEqn</a>.solve();</div><div class="line">                    Info &lt;&lt; <span class="stringliteral">&quot;ExecutionTime = &quot;</span> &lt;&lt; <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.elapsedCpuTime() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span></div><div class="line">                         &lt;&lt; <span class="stringliteral">&quot;  ClockTime = &quot;</span> &lt;&lt; <a class="code" href="laplacianProblem_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.elapsedClockTime() &lt;&lt; <span class="stringliteral">&quot; s&quot;</span></div><div class="line">                         &lt;&lt; nl &lt;&lt; endl;</div><div class="line">                }</div><div class="line"></div><div class="line">                Tlift.write();</div><div class="line">                <a class="code" href="classunsteadyBB.html#a2cd16c474cf84f9318e534ebb46d5a70">liftfieldT</a>.append(Tlift);</div><div class="line">            }</div><div class="line">        }</div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div><div class="line"><span class="comment">                               Starting the MAIN</span></div><div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div><div class="line"><span class="keywordtype">int</span> <a name="a62"></a><a class="code" href="10unsteadyBB__enclosed_8C.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// Construct the tutorial object</span></div><div class="line">    <a class="code" href="classtutorial10.html">tutorial10</a> example(argc, argv);</div><div class="line">    <span class="comment">// the offline samples for the boundary conditions</span></div><div class="line">    word par_offline_BC(<span class="stringliteral">&quot;./par_offline_BC&quot;</span>);</div><div class="line">    Eigen::MatrixXd par_off_BC = <a class="code" href="classITHACAstream.html#a1b1605dfbed6b82596cbf7749dd6b182">ITHACAstream::readMatrix</a>(par_offline_BC);</div><div class="line">    <span class="comment">// the samples which will be used for setting the boundary condition in the online stage</span></div><div class="line">    word par_online_BC(<span class="stringliteral">&quot;./par_online_BC&quot;</span>);</div><div class="line">    Eigen::MatrixXd par_on_BC = <a class="code" href="classITHACAstream.html#a1b1605dfbed6b82596cbf7749dd6b182">ITHACAstream::readMatrix</a>(par_online_BC);</div><div class="line">    <span class="comment">// Read some parameters from file</span></div><div class="line">    <a class="code" href="classITHACAparameters.html">ITHACAparameters</a> para;</div><div class="line">    <span class="keywordtype">int</span> NmodesUproj   = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesPproj   = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesTproj   = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesTproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUPproj = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPproj&quot;</span>, 5);</div><div class="line">    <span class="keywordtype">int</span> NmodesOut     = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesOut&quot;</span>, 15);</div><div class="line">    example.Pnumber = 1;</div><div class="line">    example.Tnumber = 1;</div><div class="line">    example.setParameters();</div><div class="line">    example.mu_range(0, 0) = 0.00001;</div><div class="line">    example.mu_range(0, 1) = 0.00001;</div><div class="line">    <span class="comment">// Generate equispaced samples inside the parameter range</span></div><div class="line">    example.genEquiPar();</div><div class="line">    example.inletIndexT.resize(2, 1);</div><div class="line">    example.inletIndexT &lt;&lt; 1, 2;</div><div class="line">    example.startTime = 0.0;</div><div class="line">    example.finalTime = 10.0;</div><div class="line">    example.timeStep = 0.005;</div><div class="line">    example.writeEvery = 0.01;</div><div class="line">    <span class="comment">// Perform the Offline Solve;</span></div><div class="line">    example.offlineSolve(par_off_BC);</div><div class="line">    <span class="comment">// Search the lift function for the temperature</span></div><div class="line">    example.liftSolveT();</div><div class="line">    <span class="comment">// Create homogeneous basis functions for temperature</span></div><div class="line">    example.computeLiftT(example.Tfield, example.liftfieldT, example.Tomfield);</div><div class="line">    <span class="comment">// Perform a POD decomposition for velocity temperature and pressure fields</span></div><div class="line">    <a class="code" href="classITHACAPOD.html#a793c3cc7d50f7ecb66a5b964b2e3b12c">ITHACAPOD::getModes</a>(example.Ufield, example.Umodes, example.podex, 0, 0,</div><div class="line">                        NmodesOut);</div><div class="line">    <a class="code" href="classITHACAPOD.html#a793c3cc7d50f7ecb66a5b964b2e3b12c">ITHACAPOD::getModes</a>(example.Tomfield, example.Tmodes, example.podex, 0, 0,</div><div class="line">                        NmodesOut);</div><div class="line">    <span class="comment">// Create a list with number of modes for which the projection needs to be performed</span></div><div class="line">    Eigen::MatrixXd List_of_modes(NmodesOut - 5, 1);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; List_of_modes.rows(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">    {</div><div class="line">        List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) = <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Export with number of modes for which the projection needs to be performed</span></div><div class="line">    <a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(List_of_modes, <span class="stringliteral">&quot;List_of_modes&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/l2error&quot;</span>);</div><div class="line">    <span class="comment">// Create locally the temperature modes</span></div><div class="line">    PtrList&lt;volScalarField&gt; TLmodes;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; example.liftfieldT.size(); k++)</div><div class="line">    {</div><div class="line">        TLmodes.append(example.liftfieldT[k]);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; List_of_modes.size(); k++)</div><div class="line">    {</div><div class="line">        TLmodes.append(example.Tmodes[k]);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Perform the projection for all number of modes in list List_of_modes</span></div><div class="line">    Eigen::MatrixXd L2errorProjMatrixU(example.Ufield.size(), List_of_modes.rows());</div><div class="line">    Eigen::MatrixXd L2errorProjMatrixT(example.Tfield.size(), List_of_modes.rows());</div><div class="line"></div><div class="line">    <span class="comment">// Calculate the coefficients and L2 error and store the error in a matrix for each number of modes</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; List_of_modes.rows(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd coeffU = <a class="code" href="classITHACAutilities.html#a0e7190e72e1e77eac058bcc788e364a2">ITHACAutilities::get_coeffs</a>(example.Ufield,</div><div class="line">                                 example.Umodes,</div><div class="line">                                 List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) + example.liftfield.size() + NmodesSUPproj);</div><div class="line">        Eigen::MatrixXd coeffT = <a class="code" href="classITHACAutilities.html#a0e7190e72e1e77eac058bcc788e364a2">ITHACAutilities::get_coeffs</a>(example.Tfield, TLmodes,</div><div class="line">                                 List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) + example.liftfieldT.size());</div><div class="line">        PtrList&lt;volVectorField&gt; rec_fieldU = <a class="code" href="classITHACAutilities.html#a1b47e1c037adb60976a0ceff805cad32">ITHACAutilities::reconstruct_from_coeff</a>(</div><div class="line">                example.Umodes, coeffU, List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0));</div><div class="line">        PtrList&lt;volScalarField&gt; rec_fieldT = <a class="code" href="classITHACAutilities.html#a1b47e1c037adb60976a0ceff805cad32">ITHACAutilities::reconstruct_from_coeff</a>(</div><div class="line">                TLmodes, coeffT, List_of_modes(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0) + example.liftfieldT.size());</div><div class="line">        Eigen::MatrixXd L2errorProjU = <a class="code" href="classITHACAutilities.html#a67a0fefc2a1ce68ee3cc26aef1dd4b6f">ITHACAutilities::error_listfields</a>(example.Ufield,</div><div class="line">                                       rec_fieldU);</div><div class="line">        Eigen::MatrixXd L2errorProjT = <a class="code" href="classITHACAutilities.html#a67a0fefc2a1ce68ee3cc26aef1dd4b6f">ITHACAutilities::error_listfields</a>(example.Tfield,</div><div class="line">                                       rec_fieldT);</div><div class="line">        L2errorProjMatrixU.col(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>) = L2errorProjU;</div><div class="line">        L2errorProjMatrixT.col(<a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>) = L2errorProjT;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Export the matrix containing the error</span></div><div class="line">    <a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(L2errorProjMatrixU, <span class="stringliteral">&quot;L2errorProjMatrixU&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/l2error&quot;</span>);</div><div class="line">    <a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(L2errorProjMatrixT, <span class="stringliteral">&quot;L2errorProjMatrixT&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/l2error&quot;</span>);</div><div class="line">    <span class="comment">// Get reduced matrices</span></div><div class="line">    example.projectSUP(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesUproj, NmodesPproj, NmodesTproj,</div><div class="line">                       NmodesSUPproj);</div><div class="line">    <span class="comment">// Resize the modes for projection</span></div><div class="line">    example.Tmodes.resize(NmodesTproj);</div><div class="line">    example.Umodes.resize(NmodesUproj);</div><div class="line">    <span class="comment">// Online part</span></div><div class="line">    <a class="code" href="classreducedUnsteadyBB.html">reducedUnsteadyBB</a> reduced(example);</div><div class="line">    <span class="comment">// Set values of the online solve</span></div><div class="line">    reduced.nu = 0.00001;</div><div class="line">    reduced.Pr = 0.71;</div><div class="line">    reduced.tstart = 0.0;</div><div class="line">    reduced.finalTime = 10;</div><div class="line">    reduced.dt = 0.005;</div><div class="line">    <span class="comment">// No parametrization of velocity on boundary</span></div><div class="line">    Eigen::MatrixXd vel_now_BC(0, 0);</div><div class="line"></div><div class="line">    <span class="comment">// Set the online temperature BC and solve reduced model</span></div><div class="line">    <span class="keywordflow">for</span> (label k = 0; k &lt; (par_on_BC.rows()); k++)</div><div class="line">    {</div><div class="line">        Eigen::MatrixXd temp_now_BC(2, 1);</div><div class="line">        temp_now_BC(0, 0) = par_on_BC(k, 0);</div><div class="line">        temp_now_BC(1, 0) = par_on_BC(k, 1);</div><div class="line">        reduced.solveOnline_sup(temp_now_BC, vel_now_BC, k, par_on_BC.rows());</div><div class="line">        reduced.reconstruct_sup(<span class="stringliteral">&quot;./ITHACAoutput/ReconstructionSUP&quot;</span>, 2);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Performing full order simulation for second parameter set - temp_BC</span></div><div class="line">    <a class="code" href="classtutorial10.html">tutorial10</a> HFonline2(argc, argv);</div><div class="line">    HFonline2.Pnumber = 1;</div><div class="line">    HFonline2.Tnumber = 1;</div><div class="line">    HFonline2.setParameters();</div><div class="line">    HFonline2.mu_range(0, 0) = 0.00001;</div><div class="line">    HFonline2.mu_range(0, 1) = 0.00001;</div><div class="line">    HFonline2.genEquiPar();</div><div class="line">    HFonline2.inletIndexT.resize(2, 1);</div><div class="line">    HFonline2.inletIndexT &lt;&lt; 1, 2;</div><div class="line">    HFonline2.startTime = 0.0;</div><div class="line">    HFonline2.finalTime = 10;</div><div class="line">    HFonline2.timeStep = 0.005;</div><div class="line">    HFonline2.writeEvery = 0.01;</div><div class="line">    <span class="comment">// Reconstruct the online solution</span></div><div class="line">    HFonline2.onlineSolveFull(par_on_BC, 1,</div><div class="line">                              <span class="stringliteral">&quot;./ITHACAoutput/HFonline2&quot;</span>);</div><div class="line">    <span class="comment">// Performing full order simulation for third parameter set - temp_BC</span></div><div class="line">    <a class="code" href="classtutorial10.html">tutorial10</a> HFonline3(argc, argv);</div><div class="line">    HFonline3.Pnumber = 1;</div><div class="line">    HFonline3.Tnumber = 1;</div><div class="line">    HFonline3.setParameters();</div><div class="line">    HFonline3.mu_range(0, 0) = 0.00001;</div><div class="line">    HFonline3.mu_range(0, 1) = 0.00001;</div><div class="line">    HFonline3.genEquiPar();</div><div class="line">    HFonline3.inletIndexT.resize(2, 1);</div><div class="line">    HFonline3.inletIndexT &lt;&lt; 1, 2;</div><div class="line">    HFonline3.startTime = 0.0;</div><div class="line">    HFonline3.finalTime = 10.0;</div><div class="line">    HFonline3.timeStep = 0.005;</div><div class="line">    HFonline3.writeEvery = 0.01;</div><div class="line">    <span class="comment">// Reconstruct the online solution</span></div><div class="line">    HFonline3.onlineSolveFull(par_on_BC, 2,</div><div class="line">                              <span class="stringliteral">&quot;./ITHACAoutput/HFonline3&quot;</span>);</div><div class="line">    <span class="comment">// Reading in the high-fidelity solutions for the parameter set</span></div><div class="line">    <span class="comment">// for which the offline solve has been performed</span></div><div class="line">    example.onlineSolveRead(<span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">    <span class="comment">// Reading in the high-fidelity solutions for the second parameter set</span></div><div class="line">    example.onlineSolveRead(<span class="stringliteral">&quot;./ITHACAoutput/HFonline2/&quot;</span>);</div><div class="line">    <span class="comment">// Reading in the high-fidelity solutions for the second parameter set</span></div><div class="line">    example.onlineSolveRead(<span class="stringliteral">&quot;./ITHACAoutput/HFonline3/&quot;</span>);</div><div class="line">    <span class="comment">// Calculate error between online- and corresponding full order solution</span></div><div class="line">    Eigen::MatrixXd L2errorMatrixU = <a class="code" href="classITHACAutilities.html#a67a0fefc2a1ce68ee3cc26aef1dd4b6f">ITHACAutilities::error_listfields</a>(</div><div class="line">                                         example.Ufield_on, reduced.UREC);</div><div class="line">    Eigen::MatrixXd L2errorMatrixT = <a class="code" href="classITHACAutilities.html#a67a0fefc2a1ce68ee3cc26aef1dd4b6f">ITHACAutilities::error_listfields</a>(</div><div class="line">                                         example.Tfield_on, reduced.TREC);</div><div class="line">    <span class="comment">//Export the matrix containing the error</span></div><div class="line">    <a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(L2errorMatrixU, <span class="stringliteral">&quot;L2errorMatrixU&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/l2error&quot;</span>);</div><div class="line">    <a class="code" href="classITHACAstream.html#a4ce193c3ebbec121dc5e2d6b4e039732">ITHACAstream::exportMatrix</a>(L2errorMatrixT, <span class="stringliteral">&quot;L2errorMatrixT&quot;</span>, <span class="stringliteral">&quot;eigen&quot;</span>,</div><div class="line">                               <span class="stringliteral">&quot;./ITHACAoutput/l2error&quot;</span>);</div><div class="line">    exit(0);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">///</span></div></div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
