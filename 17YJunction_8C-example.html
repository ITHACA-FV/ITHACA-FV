<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ITHACA-FV: 17YJunction.C</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ithaca-fv-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="">ITHACA-FV</a>
   &#160;<span id="projectnumber"><a href="">5.0</a></span>
   </div>
   <div id="projectbrief"><a href="https://mathlab.sissa.it/">SISSA mathLab</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">17YJunction.C</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="intro_UnsteadyNS"></a>
Introduction to tutorial 17</h1>
<p>In this tutorial, we contruct a reduced order model for a Y-junction flow problem. The Y-junction consists of two inlets and one outlet channel whose time-dependent inlet boundary conditions are controlled. The angle between each inlet and the horizontal axis is 60 degrees. The length of the channels is 2 m. The two inlets, \(\Gamma_{i1}\) and \(\Gamma_{i2}\), have a width of 0.5 m, while the outlet, \(\Gamma_{o}\), has a width of 1 m. The kinematic viscosity is equal to \(\nu\) = 0.01 m \(^2\)/s and the flow is considered laminar. As initial conditions the steady state solution, obtained with the simpleFOAM-solver, for a velocity magnitude of 1 m/s at both inlets is chosen. In this tutorial, new values of the velocity magnitude of the flow at the inlets are imposed in the reduced order model with either an iterative penalty method or a lifting function method. The reduced order model is constructed using Galerkin projection approach together with an exploitation of a pressure Poisson equation during the projection stage.</p>
<p>The following image depicts a sketch of the geometry of the two-dimensional Y-junction. </p><div class="image">
<img src="YJunction.png" alt=""/>
</div>
<h1><a class="anchor" id="code17"></a>
A detailed look into the code</h1>
<p>In this section we explain the main steps necessary to construct the tutorial NÂ°17.</p>
<h2><a class="anchor" id="header"></a>
The necessary header files</h2>
<p>First of all let's have a look at the header files that need to be included and what they are responsible for.</p>
<p>The header files of ITHACA-FV necessary for this tutorial are: &lt;<a class="el" href="unsteadyNS_8H.html" title="Header file of the unsteadyNS class.">unsteadyNS.H</a>&gt; for the full order unsteady NS problem, &lt;<a class="el" href="ITHACAPOD_8H.html" title="Header file of the ITHACAPOD class.">ITHACAPOD.H</a>&gt; for the POD decomposition, &lt;reducedUnsteadyNS.H&gt; for the construction of the reduced order problem, and finally &lt;<a class="el" href="ITHACAstream_8H.html" title="Header file of the ITHACAstream class, it contains the implementation of several methods for input ou...">ITHACAstream.H</a>&gt; for some ITHACA input-output operations.</p>
 <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="unsteadyNS_8H.html">unsteadyNS.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ReducedUnsteadyNS_8H.html">ReducedUnsteadyNS.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div>
<div class="ttc" id="aITHACAPOD_8H_html"><div class="ttname"><a href="ITHACAPOD_8H.html">ITHACAPOD.H</a></div><div class="ttdoc">Header file of the ITHACAPOD class.</div></div>
<div class="ttc" id="aITHACAstream_8H_html"><div class="ttname"><a href="ITHACAstream_8H.html">ITHACAstream.H</a></div><div class="ttdoc">Header file of the ITHACAstream class, it contains the implementation of several methods for input ou...</div></div>
<div class="ttc" id="aReducedUnsteadyNS_8H_html"><div class="ttname"><a href="ReducedUnsteadyNS_8H.html">ReducedUnsteadyNS.H</a></div><div class="ttdoc">Header file of the reducedUnsteadyNS class.</div></div>
<div class="ttc" id="aunsteadyNS_8H_html"><div class="ttname"><a href="unsteadyNS_8H.html">unsteadyNS.H</a></div><div class="ttdoc">Header file of the unsteadyNS class.</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="classtutorial17"></a>
Definition of the tutorial17 class</h2>
<p>We define the <a class="el" href="classtutorial17.html">tutorial17</a> class as a child of the <a class="el" href="classunsteadyNS.html" title="Implementation of a parametrized full order  unsteady NS problem  and preparation of the the reduced ...">unsteadyNS</a> class. </p><div class="fragment"><div class="line"><span class="keyword">class </span><a name="_a0"></a><a class="code" href="classtutorial17.html">tutorial17</a>: <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="classunsteadyNS.html">unsteadyNS</a></div>
<div class="ttc" id="aclasstutorial17_html"><div class="ttname"><a href="classtutorial17.html">tutorial17</a></div><div class="ttdef"><b>Definition:</b> <a href="17YJunction_8C_source.html#l00038">17YJunction.C:39</a></div></div>
<div class="ttc" id="aclassunsteadyNS_html"><div class="ttname"><a href="classunsteadyNS.html">unsteadyNS</a></div><div class="ttdoc">Implementation of a parametrized full order  unsteady NS problem  and preparation of the the reduced ...</div><div class="ttdef"><b>Definition:</b> <a href="unsteadyNS_8H_source.html#l00060">unsteadyNS.H:61</a></div></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        <span class="keyword">explicit</span> <a name="a2"></a><a class="code" href="classtutorial17.html#a11de25dfeaff748b8dada5ba0c551297">tutorial17</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">            :</div>
<div class="line">            <a name="a3"></a><a class="code" href="classunsteadyNS.html#a94671a2e15e331569938cb3bd4fb5ba7">unsteadyNS</a>(argc, argv),</div>
<div class="line">            <a name="a4"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>(<a name="a5"></a><a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div>
<div class="line">            <a name="a6"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>(<a name="a7"></a><a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>())</div>
<div class="line">        {}</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Fields To Perform</span></div>
<div class="line">        volVectorField&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>;</div>
<div class="line">        volScalarField&amp; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>;</div>
<div class="ttc" id="aclasssteadyNS_html_ae8b03bc316b446d3ad311a80c5ada715"><div class="ttname"><a href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">steadyNS::_U</a></div><div class="ttdeci">autoPtr&lt; volVectorField &gt; _U</div><div class="ttdoc">Velocity field.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00266">steadyNS.H:266</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_afe342c9980231332bb8c22bbceb32254"><div class="ttname"><a href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">steadyNS::_p</a></div><div class="ttdeci">autoPtr&lt; volScalarField &gt; _p</div><div class="ttdoc">Pressure field.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00263">steadyNS.H:263</a></div></div>
<div class="ttc" id="aclasstutorial17_html_a11de25dfeaff748b8dada5ba0c551297"><div class="ttname"><a href="classtutorial17.html#a11de25dfeaff748b8dada5ba0c551297">tutorial17::tutorial17</a></div><div class="ttdeci">tutorial17(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="17YJunction_8C_source.html#l00041">17YJunction.C:41</a></div></div>
<div class="ttc" id="aclassunsteadyNS_html_a94671a2e15e331569938cb3bd4fb5ba7"><div class="ttname"><a href="classunsteadyNS.html#a94671a2e15e331569938cb3bd4fb5ba7">unsteadyNS::unsteadyNS</a></div><div class="ttdeci">unsteadyNS()</div><div class="ttdoc">Construct Null.</div><div class="ttdef"><b>Definition:</b> <a href="unsteadyNS_8C_source.html#l00039">unsteadyNS.C:39</a></div></div>
<div class="ttc" id="asrc_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_html_a334650304cdcdff41898bee9eaf2e3db"><div class="ttname"><a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a></div><div class="ttdeci">volScalarField &amp; p</div><div class="ttdef"><b>Definition:</b> <a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_source.html#l00041">createFields.H:41</a></div></div>
<div class="ttc" id="asrc_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_html_ae4919c063fc0646445cdcafee89ebd60"><div class="ttname"><a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a></div><div class="ttdeci">volVectorField &amp; U</div><div class="ttdef"><b>Definition:</b> <a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_source.html#l00066">createFields.H:66</a></div></div>
</div><!-- fragment --><p> Inside the <a class="el" href="classtutorial17.html">tutorial17</a> class we define the offlineSolve method according to the specific problem that needs to be solved. If the offline solve has been previously performed then the method just reads the existing snapshots from the Offline directory. Otherwise it performs the offline solve.</p>
<div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a name="a8"></a><a class="code" href="classtutorial17.html#a72ab84b213b6dce9d235c40bd604cd2c">offlineSolve</a>()</div>
<div class="ttc" id="aclasstutorial17_html_a72ab84b213b6dce9d235c40bd604cd2c"><div class="ttname"><a href="classtutorial17.html#a72ab84b213b6dce9d235c40bd604cd2c">tutorial17::offlineSolve</a></div><div class="ttdeci">void offlineSolve()</div><div class="ttdef"><b>Definition:</b> <a href="17YJunction_8C_source.html#l00052">17YJunction.C:52</a></div></div>
<div class="line">        {</div>
<div class="line">            List&lt;scalar&gt; mu_now(1);</div>
<div class="line">            volVectorField <a name="a9"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4a67efa51a0845eff228b219d8dc81a">U0</a> = <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>;</div>
<div class="line">            volScalarField P0 = <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a name="a10"></a><a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div>
<div class="line">            {</div>
<div class="line">                <a name="a11"></a><a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a name="a12"></a><a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div>
<div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a name="a13"></a><a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div>
<div class="line">            }</div>
<div class="ttc" id="aclassreductionProblem_html_a752b5e2d6094c1ee18da4850443f1617"><div class="ttname"><a href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">reductionProblem::offline</a></div><div class="ttdeci">bool offline</div><div class="ttdoc">Boolean variable, it is 1 if the Offline phase has already been computed, else 0.</div><div class="ttdef"><b>Definition:</b> <a href="reductionProblem_8H_source.html#l00099">reductionProblem.H:99</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a30b8d9c76cc7f7f4d7dd6406cedba537"><div class="ttname"><a href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">steadyNS::Pfield</a></div><div class="ttdeci">PtrList&lt; volScalarField &gt; Pfield</div><div class="ttdoc">List of pointers used to form the pressure snapshots matrix.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00086">steadyNS.H:86</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a4efe3474afaa557ad5a211631115124f"><div class="ttname"><a href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">steadyNS::Ufield</a></div><div class="ttdeci">PtrList&lt; volVectorField &gt; Ufield</div><div class="ttdoc">List of pointers used to form the velocity snapshots matrix.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00089">steadyNS.H:89</a></div></div>
<div class="ttc" id="anamespaceITHACAstream_html_a23375000c57c5151da30c6be9284b764"><div class="ttname"><a href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a></div><div class="ttdeci">void read_fields(PtrList&lt; GeometricField&lt; Type, PatchField, GeoMesh &gt;&gt; &amp;Lfield, word Name, fileName casename, int first_snap, int n_snap)</div><div class="ttdoc">Function to read a list of fields from the name of the field and casename.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAstream_8C_source.html#l00433">ITHACAstream.C:433</a></div></div>
<div class="ttc" id="asrc_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_html_ae4a67efa51a0845eff228b219d8dc81a"><div class="ttname"><a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4a67efa51a0845eff228b219d8dc81a">U0</a></div><div class="ttdeci">volVectorField U0(U)</div></div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a> = <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4a67efa51a0845eff228b219d8dc81a">U0</a>;</div>
<div class="line">                <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a> = P0;</div>
<div class="line">                mu_now[0] = <a name="a14"></a><a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, 0);</div>
<div class="line">                <a name="a15"></a><a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(mu_now);</div>
<div class="line">            }</div>
<div class="ttc" id="aclassreductionProblem_html_acca797c9e7595c83d45d40c286b9a6ee"><div class="ttname"><a href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">reductionProblem::mu</a></div><div class="ttdeci">Eigen::MatrixXd mu</div><div class="ttdoc">Row matrix of parameters.</div><div class="ttdef"><b>Definition:</b> <a href="reductionProblem_8H_source.html#l00089">reductionProblem.H:89</a></div></div>
<div class="ttc" id="aclassreductionProblem_html_aeab985e1958591a9de375c415c8d5e8d"><div class="ttname"><a href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">reductionProblem::truthSolve</a></div><div class="ttdeci">void truthSolve()</div><div class="ttdoc">Perform a TruthSolve.</div><div class="ttdef"><b>Definition:</b> <a href="reductionProblem_8C_source.html#l00097">reductionProblem.C:97</a></div></div>
<div class="line">        }</div>
</div><!-- fragment --><p> We also define a liftSolve method, which will be needed to construct the lifting functions if the lifting function method is used:</p>
<div class="fragment"><div class="line">        <span class="keywordtype">void</span> <a name="a16"></a><a class="code" href="classsteadyNS.html#af11a2fa8637db86b8b129ee9d84de091">liftSolve</a>(Eigen::MatrixXd BCs)</div>
<div class="ttc" id="aclasssteadyNS_html_af11a2fa8637db86b8b129ee9d84de091"><div class="ttname"><a href="classsteadyNS.html#af11a2fa8637db86b8b129ee9d84de091">steadyNS::liftSolve</a></div><div class="ttdeci">void liftSolve()</div><div class="ttdoc">Perform a lift solve.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8C_source.html#l00252">steadyNS.C:252</a></div></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (label k = 0; k &lt; <a name="a17"></a><a class="code" href="classreductionProblem.html#a0e07dd8aeee6491275df8034e723de95">inletPatch</a>.rows(); k++)</div>
<div class="line">            {</div>
<div class="line">                Time&amp; <a name="a18"></a><a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a> = <a name="a19"></a><a class="code" href="classsteadyNS.html#a4493d1f1ce7e2008c85b1dde7c027de4">_runTime</a>();</div>
<div class="line">                surfaceScalarField&amp; <a name="a20"></a><a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> = <a name="a21"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2UnsteadyNSExplicit_2createFields_8H.html#a40162fde1df058a2278666d0bc39a8e2">_phi</a>();</div>
<div class="line">                fvMesh&amp; <a name="a22"></a><a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a> = <a name="a23"></a><a class="code" href="classsteadyNS.html#a6a233a5c129864684e67e41d04983e01">_mesh</a>();</div>
<div class="line">                volScalarField <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a> = <a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>();</div>
<div class="line">                volVectorField <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a> = <a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>();</div>
<div class="line">                IOMRFZoneList&amp; MRF = <a name="a24"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ab6622d3fa81ea4ad8462f16aa6a8da07">_MRF</a>();</div>
<div class="line">                label BCind = <a class="code" href="classreductionProblem.html#a0e07dd8aeee6491275df8034e723de95">inletPatch</a>(k, 0);</div>
<div class="line">                volVectorField Ulift(<span class="stringliteral">&quot;Ulift&quot;</span> + name(k), <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>);</div>
<div class="line">                instantList Times = <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.times();</div>
<div class="line">                <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.setTime(Times[1], 1);</div>
<div class="line">                pisoControl potentialFlow(<a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>, <span class="stringliteral">&quot;potentialFlow&quot;</span>);</div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Solving a lifting Problem&quot;</span> &lt;&lt; endl;</div>
<div class="line">                Vector&lt;double&gt; v1(0, 0, 0);</div>
<div class="line">                v1[0] = BCs(0, k);</div>
<div class="line">                v1[1] = BCs(1, k);</div>
<div class="line">                Vector&lt;double&gt; <a name="a25"></a><a class="code" href="msrProblem_2createConstants_8H.html#a5cb9477af496b1370b25434b206c736e">v0</a>(0, 0, 0);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (label j = 0; j &lt; <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>.boundaryField().size(); j++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (j == BCind)</div>
<div class="line">                    {</div>
<div class="line">                        <a name="a26"></a><a class="code" href="namespaceITHACAutilities.html#aaf2554bab8cb1c5a0aac263380019ebd">assignBC</a>(Ulift, j, v1);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>.boundaryField()[BCind].type() == <span class="stringliteral">&quot;fixedValue&quot;</span>)</div>
<div class="line">                    {</div>
<div class="line">                        <a class="code" href="namespaceITHACAutilities.html#aaf2554bab8cb1c5a0aac263380019ebd">assignBC</a>(Ulift, j, <a class="code" href="msrProblem_2createConstants_8H.html#a5cb9477af496b1370b25434b206c736e">v0</a>);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <a name="a27"></a><a class="code" href="namespaceITHACAutilities.html#a174f438bc385404a157f936cefc52d75">assignIF</a>(Ulift, <a class="code" href="msrProblem_2createConstants_8H.html#a5cb9477af496b1370b25434b206c736e">v0</a>);</div>
<div class="line">                    <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> = linearInterpolate(Ulift) &amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.Sf();</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Constructing velocity potential field Phi\n&quot;</span> &lt;&lt; endl;</div>
<div class="line">                volScalarField Phi</div>
<div class="line">                (</div>
<div class="line">                    IOobject</div>
<div class="line">                    (</div>
<div class="line">                        <span class="stringliteral">&quot;Phi&quot;</span>,</div>
<div class="line">                        <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.timeName(),</div>
<div class="line">                        <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>,</div>
<div class="line">                        IOobject::READ_IF_PRESENT,</div>
<div class="line">                        IOobject::NO_WRITE</div>
<div class="line">                    ),</div>
<div class="line">                    <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>,</div>
<div class="line">                    dimensionedScalar(<span class="stringliteral">&quot;Phi&quot;</span>, dimLength * dimVelocity, 0),</div>
<div class="line">                    <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>.boundaryField().types()</div>
<div class="line">                );</div>
<div class="line">                label PhiRefCell = 0;</div>
<div class="line">                scalar PhiRefValue = 0;</div>
<div class="line">                <a name="a28"></a><a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#afeb00419cfdbd69ab20e430caf6e541b">setRefCell</a></div>
<div class="line">                (</div>
<div class="line">                    Phi,</div>
<div class="line">                    potentialFlow.dict(),</div>
<div class="line">                    PhiRefCell,</div>
<div class="line">                    PhiRefValue</div>
<div class="line">                );</div>
<div class="line">                <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.setFluxRequired(Phi.name());</div>
<div class="line">                <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.functionObjects().start();</div>
<div class="line">                MRF.makeRelative(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>);</div>
<div class="line">                <a name="a29"></a><a class="code" href="msrProblem_2pEqn_8H.html#a2763a4e809e5ae1f9caf5fb4bc42a66e">adjustPhi</a>(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>, Ulift, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">while</span> (potentialFlow.correctNonOrthogonal())</div>
<div class="line">                {</div>
<div class="line">                    fvScalarMatrix PhiEqn</div>
<div class="line">                    (</div>
<div class="line">                        fvm::laplacian(dimensionedScalar(<span class="stringliteral">&quot;1&quot;</span>, dimless, 1), Phi)</div>
<div class="line">                        ==</div>
<div class="line">                        fvc::div(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>)</div>
<div class="line">                    );</div>
<div class="line">                    PhiEqn.setReference(PhiRefCell, PhiRefValue);</div>
<div class="line">                    PhiEqn.solve();</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (potentialFlow.finalNonOrthogonalIter())</div>
<div class="line">                    {</div>
<div class="line">                        <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> -= PhiEqn.flux();</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                MRF.makeAbsolute(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>);</div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Continuity error = &quot;</span></div>
<div class="line">                     &lt;&lt; mag(fvc::div(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>))().weightedAverage(<a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.V()).value()</div>
<div class="line">                     &lt;&lt; endl;</div>
<div class="line">                Ulift = fvc::reconstruct(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>);</div>
<div class="line">                Ulift.correctBoundaryConditions();</div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Interpolated velocity error = &quot;</span></div>
<div class="line">                     &lt;&lt; (sqrt(sum(sqr((fvc::interpolate(<a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>) &amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.Sf()) - <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>)))</div>
<div class="line">                         / sum(<a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.magSf())).value()</div>
<div class="line">                     &lt;&lt; endl;</div>
<div class="line">                Ulift.write();</div>
<div class="line">                volVectorField Uzero</div>
<div class="line">                (</div>
<div class="line">                    IOobject</div>
<div class="line">                    (</div>
<div class="line">                        <span class="stringliteral">&quot;Uzero&quot;</span>,</div>
<div class="line">                        <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>.time().timeName(),</div>
<div class="line">                        <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>.mesh(),</div>
<div class="line">                        IOobject::NO_READ,</div>
<div class="line">                        IOobject::AUTO_WRITE</div>
<div class="line">                    ),</div>
<div class="line">                    <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>.mesh(),</div>
<div class="line">                    dimensionedVector(<span class="stringliteral">&quot;zero&quot;</span>, <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>.dimensions(), vector::zero)</div>
<div class="line">                );</div>
<div class="line">                volVectorField Uliftx(<span class="stringliteral">&quot;Uliftx&quot;</span> + name(k), Uzero);</div>
<div class="line">                Uliftx.replace(0, Ulift.component(0));</div>
<div class="line">                Uliftx.write();</div>
<div class="line">                <a name="a30"></a><a class="code" href="classsteadyNS.html#a6e6f9d485657cc2c1fea709aa8ad5ec9">liftfield</a>.append((Uliftx).clone());</div>
<div class="line">                volVectorField Ulifty(<span class="stringliteral">&quot;Ulifty&quot;</span> + name(k), Uzero);</div>
<div class="line">                Ulifty.replace(1, Ulift.component(1));</div>
<div class="line">                Ulifty.write();</div>
<div class="line">                <a class="code" href="classsteadyNS.html#a6e6f9d485657cc2c1fea709aa8ad5ec9">liftfield</a>.append((Ulifty).clone());</div>
<div class="ttc" id="aITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H_html_ad3874bb3b9ab8a24930b4793e928108d"><div class="ttname"><a href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a></div><div class="ttdeci">Foam::fvMesh &amp; mesh</div><div class="ttdef"><b>Definition:</b> <a href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H_source.html#l00047">createMesh.H:47</a></div></div>
<div class="ttc" id="aITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H_html_a477812c93e1698f206b3c3266041d0fd"><div class="ttname"><a href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a></div><div class="ttdeci">Foam::Time &amp; runTime</div><div class="ttdef"><b>Definition:</b> <a href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H_source.html#l00033">createTime.H:33</a></div></div>
<div class="ttc" id="aclassreductionProblem_html_a0e07dd8aeee6491275df8034e723de95"><div class="ttname"><a href="classreductionProblem.html#a0e07dd8aeee6491275df8034e723de95">reductionProblem::inletPatch</a></div><div class="ttdeci">Eigen::MatrixXi inletPatch</div><div class="ttdoc">Matrix that contains informations about the inlet boundaries without specifing the direction Rows = N...</div><div class="ttdef"><b>Definition:</b> <a href="reductionProblem_8H_source.html#l00153">reductionProblem.H:153</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a4493d1f1ce7e2008c85b1dde7c027de4"><div class="ttname"><a href="classsteadyNS.html#a4493d1f1ce7e2008c85b1dde7c027de4">steadyNS::_runTime</a></div><div class="ttdeci">autoPtr&lt; Time &gt; _runTime</div><div class="ttdoc">Time.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00293">steadyNS.H:293</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a6a233a5c129864684e67e41d04983e01"><div class="ttname"><a href="classsteadyNS.html#a6a233a5c129864684e67e41d04983e01">steadyNS::_mesh</a></div><div class="ttdeci">autoPtr&lt; fvMesh &gt; _mesh</div><div class="ttdoc">Mesh.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00284">steadyNS.H:284</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a6e6f9d485657cc2c1fea709aa8ad5ec9"><div class="ttname"><a href="classsteadyNS.html#a6e6f9d485657cc2c1fea709aa8ad5ec9">steadyNS::liftfield</a></div><div class="ttdeci">PtrList&lt; volVectorField &gt; liftfield</div><div class="ttdoc">List of pointers used to form the list of lifting functions.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00110">steadyNS.H:110</a></div></div>
<div class="ttc" id="amsrProblem_2createConstants_8H_html_a5cb9477af496b1370b25434b206c736e"><div class="ttname"><a href="msrProblem_2createConstants_8H.html#a5cb9477af496b1370b25434b206c736e">v0</a></div><div class="ttdeci">volScalarField v0(v)</div></div>
<div class="ttc" id="amsrProblem_2createPhi_8H_html_a1a97abcf6c141f539994c8a21c8daca7"><div class="ttname"><a href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a></div><div class="ttdeci">surfaceScalarField &amp; phi</div><div class="ttdef"><b>Definition:</b> <a href="msrProblem_2createPhi_8H_source.html#l00046">createPhi.H:46</a></div></div>
<div class="ttc" id="amsrProblem_2pEqn_8H_html_a2763a4e809e5ae1f9caf5fb4bc42a66e"><div class="ttname"><a href="msrProblem_2pEqn_8H.html#a2763a4e809e5ae1f9caf5fb4bc42a66e">adjustPhi</a></div><div class="ttdeci">adjustPhi(phiHbyA, U, p)</div></div>
<div class="ttc" id="anamespaceITHACAutilities_html_a174f438bc385404a157f936cefc52d75"><div class="ttname"><a href="namespaceITHACAutilities.html#a174f438bc385404a157f936cefc52d75">ITHACAutilities::assignIF</a></div><div class="ttdeci">void assignIF(GeometricField&lt; Type, fvPatchField, volMesh &gt; &amp;s, Type value)</div><div class="ttdoc">Assign internal field.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAassign_8C_source.html#l00094">ITHACAassign.C:94</a></div></div>
<div class="ttc" id="anamespaceITHACAutilities_html_aaf2554bab8cb1c5a0aac263380019ebd"><div class="ttname"><a href="namespaceITHACAutilities.html#aaf2554bab8cb1c5a0aac263380019ebd">ITHACAutilities::assignBC</a></div><div class="ttdeci">void assignBC(GeometricField&lt; scalar, fvPatchField, volMesh &gt; &amp;s, label BC_ind, double value)</div><div class="ttdoc">Assign uniform Boundary Condition to a volScalarField.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAassign_8C_source.html#l00143">ITHACAassign.C:143</a></div></div>
<div class="ttc" id="asrc_2ITHACA__FOMPROBLEMS_2UnsteadyNSExplicit_2createFields_8H_html_a40162fde1df058a2278666d0bc39a8e2"><div class="ttname"><a href="src_2ITHACA__FOMPROBLEMS_2UnsteadyNSExplicit_2createFields_8H.html#a40162fde1df058a2278666d0bc39a8e2">_phi</a></div><div class="ttdeci">_phi</div><div class="ttdef"><b>Definition:</b> <a href="src_2ITHACA__FOMPROBLEMS_2UnsteadyNSExplicit_2createFields_8H_source.html#l00110">createFields.H:110</a></div></div>
<div class="ttc" id="asrc_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_html_ab6622d3fa81ea4ad8462f16aa6a8da07"><div class="ttname"><a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ab6622d3fa81ea4ad8462f16aa6a8da07">_MRF</a></div><div class="ttdeci">_MRF</div><div class="ttdef"><b>Definition:</b> <a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_source.html#l00093">createFields.H:93</a></div></div>
<div class="ttc" id="asrc_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H_html_afeb00419cfdbd69ab20e430caf6e541b"><div class="ttname"><a href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#afeb00419cfdbd69ab20e430caf6e541b">setRefCell</a></div><div class="ttdeci">setRefCell(p, mesh.solutionDict().subDict(&quot;SIMPLE&quot;), pRefCell, pRefValue)</div></div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --> <h2><a class="anchor" id="main"></a>
Definition of the main function</h2>
<p>In this section we show the definition of the main function. First we construct the object "example" of type <a class="el" href="classtutorial17.html">tutorial17</a>:</p>
<div class="fragment"><div class="line">    <a class="code" href="classtutorial17.html">tutorial17</a> example(argc, argv);</div>
</div><!-- fragment --><p> Next, we specify the name of the file that contains the values at the boundary for the full order solver for each time step. The inlet velocity magnitude of, alternately, inlet 1 or 2 is increased or decreased linearly over time between 1.0 m/s to 0.5 m/s.</p>
<div class="fragment"><div class="line">    word par_offline_BC(<span class="stringliteral">&quot;./timeBCoff&quot;</span>);</div>
</div><!-- fragment --><p> The input file only contains the boundary values at inlet 1 and 2 in the x-direction and y-direction. We are storing these values in an matrix together with zero velocity in the z-direction since it is required to specify the velocity in the x,y and z direction even though the problem is two-dimensional.</p>
<div class="fragment"><div class="line">    Eigen::MatrixXd timeBCoff2D = <a name="a31"></a><a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_offline_BC);</div>
<div class="ttc" id="anamespaceITHACAstream_html_aa259fffbddd2f4a42cc3a4a76f839ef6"><div class="ttname"><a href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a></div><div class="ttdeci">List&lt; Eigen::MatrixXd &gt; readMatrix(word folder, word mat_name)</div><div class="ttdoc">Read a three dimensional matrix from a txt file in Eigen format.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAstream_8C_source.html#l00351">ITHACAstream.C:351</a></div></div>
<div class="line">    Eigen::MatrixXd timeBCoff3D = Eigen::MatrixXd::Zero(6, timeBCoff2D.cols());</div>
<div class="line">    timeBCoff3D.row(0) = timeBCoff2D.row(0);</div>
<div class="line">    timeBCoff3D.row(1) = timeBCoff2D.row(1);</div>
<div class="line">    timeBCoff3D.row(3) = timeBCoff2D.row(2);</div>
<div class="line">    timeBCoff3D.row(4) = timeBCoff2D.row(3);</div>
<div class="line">    example.timeBCoff = timeBCoff3D;</div>
</div><!-- fragment --><p> We also load the new inlet velocities for the reduced order solver from a text file and store the values in a matrix.</p>
<div class="fragment"><div class="line">    Eigen::MatrixXd par_on_BC;</div>
<div class="line">    word par_online_BC(<span class="stringliteral">&quot;./timeBCon&quot;</span>);</div>
<div class="line">    par_on_BC = <a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_online_BC);</div>
</div><!-- fragment --><p> Then we parse the ITHACAdict file to determine the number of modes to be written out and also the ones to be used for projection of the velocity and pressure: </p><div class="fragment"><div class="line">    <a name="_a32"></a><a class="code" href="classITHACAparameters.html">ITHACAparameters</a>* <a name="a33"></a><a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a> = <a name="a34"></a><a class="code" href="classITHACAparameters.html#adf4e7e15954b8779d57ed6478a19027f">ITHACAparameters::getInstance</a>(example._mesh(),</div>
<div class="ttc" id="aclassITHACAparameters_html"><div class="ttname"><a href="classITHACAparameters.html">ITHACAparameters</a></div><div class="ttdoc">Class for the definition of some general parameters, the parameters must be defined from the file ITH...</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAparameters_8H_source.html#l00040">ITHACAparameters.H:41</a></div></div>
<div class="ttc" id="aclassITHACAparameters_html_adf4e7e15954b8779d57ed6478a19027f"><div class="ttname"><a href="classITHACAparameters.html#adf4e7e15954b8779d57ed6478a19027f">ITHACAparameters::getInstance</a></div><div class="ttdeci">static ITHACAparameters * getInstance()</div><div class="ttdoc">Gets an instance of ITHACAparameters, to be used if the instance is already existing.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAparameters_8C_source.html#l00053">ITHACAparameters.C:53</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a8a08f32ba7817588d13e5266ebdb1373"><div class="ttname"><a href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">steadyNS::para</a></div><div class="ttdeci">ITHACAparameters * para</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00082">steadyNS.H:80</a></div></div>
<div class="line">                             example._runTime());</div>
<div class="line">    <span class="keywordtype">int</span> NmodesUout = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a name="a35"></a><a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUout&quot;</span>, 15);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesPout = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPout&quot;</span>, 15);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesSUPout = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPout&quot;</span>, 15);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesUproj = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUproj&quot;</span>, 10);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesPproj = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPproj&quot;</span>, 10);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesSUPproj = <a class="code" href="classsteadyNS.html#a8a08f32ba7817588d13e5266ebdb1373">para</a>-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPproj&quot;</span>, 10);</div>
<div class="ttc" id="aclassITHACAparameters_html_a87b488473043188ee5588db8a0bdd461"><div class="ttname"><a href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAparameters::ITHACAdict</a></div><div class="ttdeci">IOdictionary * ITHACAdict</div><div class="ttdoc">Dictionary for input objects from file.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAparameters_8H_source.html#l00062">ITHACAparameters.H:62</a></div></div>
</div><!-- fragment --><p> we note that a default value can be assigned in case the parser did not find the corresponding string in the ITHACAdict file.</p>
<p>In our implementation, the viscocity needs to be defined by specifying that Nparameters=1, Nsamples=1, and the parameter ranges from 0.01 to 0.01 equispaced, i.e.</p>
<div class="fragment"><div class="line">    example.Pnumber = 1;</div>
<div class="line">    example.Tnumber = 1;</div>
<div class="line">    example.setParameters();</div>
<div class="line">    <span class="comment">// Set the parameter ranges</span></div>
<div class="line">    example.mu_range(0, 0) = 0.01;</div>
<div class="line">    example.mu_range(0, 1) = 0.01;</div>
<div class="line">    <span class="comment">// Generate equispaced samples inside the parameter range</span></div>
<div class="line">    example.genEquiPar();</div>
</div><!-- fragment --><p> After that we set the inlet boundaries where we have the non homogeneous BC</p>
<div class="fragment"><div class="line">    example.inletIndex.resize(4, 2); <span class="comment">// rows: total number of patches</span></div>
<div class="line">    example.inletIndex(0, 0) = 1;  <span class="comment">// Patch inlet 1</span></div>
<div class="line">    example.inletIndex(0, 1) = 0;  <span class="comment">// Patch inlet 1: x-direction</span></div>
<div class="line">    example.inletIndex(1, 0) = 1;  <span class="comment">// Patch inlet 1: y-direction</span></div>
<div class="line">    example.inletIndex(1, 1) = 1;  <span class="comment">// Patch inlet 2</span></div>
<div class="line">    example.inletIndex(2, 0) = 2;  <span class="comment">// Patch inlet 2: x-direction</span></div>
<div class="line">    example.inletIndex(2, 1) = 0;  <span class="comment">// Patch inlet 2: y-direction</span></div>
<div class="line">    example.inletIndex(3, 0) = 2;  <span class="comment">// Patch inlet 2: x-direction</span></div>
<div class="line">    example.inletIndex(3, 1) = 1;  <span class="comment">// Patch inlet 2: y-direction</span></div>
</div><!-- fragment --><p> as well as the patch number of inlet 1 and the patch number of inlet 2. </p><div class="fragment"><div class="line">    example.inletPatch.resize(2, 1);</div>
<div class="line">    example.inletPatch(0, 0) = example.inletIndex(0, 0);  <span class="comment">// Patch inlet 1</span></div>
<div class="line">    example.inletPatch(1, 0) = example.inletIndex(2, 0);  <span class="comment">// Patch inlet 2</span></div>
</div><!-- fragment --><p> We set the parameters for the time integration, so as to simulate 12.0 seconds of simulation time, with a step size = 0.0005 seconds, and the data are dumped every 0.03 seconds, i.e.</p>
<div class="fragment"><div class="line">    example.startTime = 0;</div>
<div class="line">    example.finalTime = 12;</div>
<div class="line">    example.timeStep = 0.0005;</div>
<div class="line">    example.writeEvery = 0.03;</div>
</div><!-- fragment --><p> Now we are ready to perform the offline stage:</p>
<div class="fragment"><div class="line">    example.offlineSolve();</div>
</div><!-- fragment --><p> After that, the modes for the velocity and pressure are obtained. The lifting function method requires the velocity modes to be homogeneous. Therefore we differentiate here between the lifting function method and the penalty method. Which bcMethod to be used can be specified in the ITHACAdict file.</p>
<p>In the case of the lifting function method, we specify first a unit value onto the inlet patches in the x- and y-direction </p><div class="fragment"><div class="line">    <span class="keywordflow">if</span> (example.bcMethod == <span class="stringliteral">&quot;lift&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Search the lift function</span></div>
<div class="line">        Eigen::MatrixXd BCs;</div>
<div class="line">        BCs.resize(2, 2);</div>
<div class="line">        BCs(0, 0) = 1;  <span class="comment">// Patch inlet 1</span></div>
<div class="line">        BCs(1, 0) = -1;  <span class="comment">// Patch inlet 2</span></div>
<div class="line">        BCs(0, 1) = 1;  <span class="comment">// Patch inlet 1</span></div>
<div class="line">        BCs(1, 1) = 1;  <span class="comment">// Patch inlet 2</span></div>
</div><!-- fragment --><p> Then we solve for the lifting functions; one lifting function for each inlet boundary condition and direction </p><div class="fragment"><div class="line">        example.liftSolve(BCs);</div>
</div><!-- fragment --><p> The lifting functions are normalized </p><div class="fragment"><div class="line">        <a name="a36"></a><a class="code" href="namespaceITHACAutilities.html#a8793ffd94679609166b4bd53f3496b9c">ITHACAutilities::normalizeFields</a>(example.liftfield);</div>
<div class="ttc" id="anamespaceITHACAutilities_html_a8793ffd94679609166b4bd53f3496b9c"><div class="ttname"><a href="namespaceITHACAutilities.html#a8793ffd94679609166b4bd53f3496b9c">ITHACAutilities::normalizeFields</a></div><div class="ttdeci">void normalizeFields(PtrList&lt; GeometricField&lt; Type, fvPatchField, volMesh &gt;&gt; &amp;fields)</div><div class="ttdoc">Normalize list of Geometric fields.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAassign_8C_source.html#l00622">ITHACAassign.C:622</a></div></div>
</div><!-- fragment --><p> and the velocity snapshots are homogenized by subtracting the normalized lifting functions from the velocity snapshots. </p><div class="fragment"><div class="line">        example.computeLift(example.Ufield, example.liftfield, example.Uomfield);</div>
</div><!-- fragment --><p> Finally, we obtain the homogeneous velocity modes </p><div class="fragment"><div class="line">        <a name="a37"></a><a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Uomfield, example.Umodes, example._U().name(),</div>
<div class="ttc" id="anamespaceITHACAPOD_html_a7c9767253fcbf4c4f0ea01c0a071672f"><div class="ttname"><a href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a></div><div class="ttdeci">void getModes(PtrList&lt; GeometricField&lt; Type, PatchField, GeoMesh &gt;&gt; &amp;snapshots, PtrList&lt; GeometricField&lt; Type, PatchField, GeoMesh &gt;&gt; &amp;modes, word fieldName, bool podex, bool supex, bool sup, label nmodes)</div><div class="ttdoc">Computes the bases or reads them for a field.</div><div class="ttdef"><b>Definition:</b> <a href="ITHACAPOD_8C_source.html#l00092">ITHACAPOD.C:92</a></div></div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesUout);</div>
</div><!-- fragment --><p> and the pressure modes. </p><div class="fragment"><div class="line">        <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example._p().name(),</div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesPout);</div>
<div class="line">    }</div>
</div><!-- fragment --><p> If the penalty method is used, the velocity and pressure modes are computed as follows </p><div class="fragment"><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (example.bcMethod == <span class="stringliteral">&quot;penalty&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Perform a POD decomposition for velocity and pressure</span></div>
<div class="line">        <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Ufield, example.Umodes, example._U().name(),</div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesUout);</div>
<div class="line">        <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example._p().name(),</div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesPout);</div>
<div class="line">    }</div>
</div><!-- fragment --><p> Then the projection onto the POD modes is performed using the Pressure Poisson Equation (PPE) approach. </p><div class="fragment"><div class="line">    example.projectPPE(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesUproj, NmodesPproj, NmodesSUPproj);</div>
</div><!-- fragment --><p> Now that we obtained all the necessary information from the POD decomposition and the reduced matrices, we are ready to construct the dynamical system for the reduced order model (ROM). We proceed by constructing the object "reduced" of type <a class="el" href="classreducedUnsteadyNS.html" title="Class where it is implemented a reduced problem for the  unsteady Navier-stokes  problem.">reducedUnsteadyNS</a>:</p>
<div class="fragment"><div class="line">    <a name="_a38"></a><a class="code" href="classreducedUnsteadyNS.html">reducedUnsteadyNS</a> reduced(example);</div>
<div class="ttc" id="aclassreducedUnsteadyNS_html"><div class="ttname"><a href="classreducedUnsteadyNS.html">reducedUnsteadyNS</a></div><div class="ttdoc">Class where it is implemented a reduced problem for the  unsteady Navier-stokes  problem.</div><div class="ttdef"><b>Definition:</b> <a href="ReducedUnsteadyNS_8H_source.html#l00113">ReducedUnsteadyNS.H:114</a></div></div>
</div><!-- fragment --><p> And then we can use the constructed ROM to perform the online procedure, from which we can simulate the problem for new values of the inlet velocities that vary linearly over time. We are keeping the time stepping the same as for the offline stage, but the ROM simulation (online stage) is performed for a longer time period.</p>
<div class="fragment"><div class="line">    reduced.nu = 0.01;</div>
<div class="line">    reduced.tstart = 0;</div>
<div class="line">    reduced.finalTime = 18;</div>
<div class="line">    reduced.dt = 0.0005;</div>
<div class="line">    reduced.storeEvery = 0.0005;</div>
<div class="line">    reduced.exportEvery = 0.03;</div>
</div><!-- fragment --><p> We have to specify a new value for the inlet velocities, which were already loaded from a text file</p>
<div class="fragment"><div class="line">    Eigen::MatrixXd vel_now = par_on_BC;</div>
</div><!-- fragment --><p> If the penalty method is used, we also have to set the parameters for the iterative penalty method to determine a suitable penalty factor</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> (example.bcMethod == <span class="stringliteral">&quot;penalty&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Set values of the iterative penalty method</span></div>
<div class="line">        reduced.maxIterPenalty = 100;</div>
<div class="line">        reduced.tolerancePenalty = 1e-5;</div>
<div class="line">        reduced.timeStepPenalty = 5;</div>
<div class="line">        <span class="comment">// Set initial quess for penalty factors</span></div>
<div class="line">        reduced.tauIter = Eigen::MatrixXd::Zero(4, 1);</div>
<div class="line">        reduced.tauIter &lt;&lt;  1e-6, 1e-6, 1e-6, 1e-6;</div>
<div class="line">        <span class="comment">// Solve for the penalty factors with the iterative solver</span></div>
<div class="line">        reduced.tauU = reduced.penalty_PPE(vel_now, reduced.tauIter);</div>
<div class="line">    }</div>
</div><!-- fragment --><p> and then the online solve is performed.</p>
<div class="fragment"><div class="line">    reduced.solveOnline_PPE(vel_now);</div>
</div><!-- fragment --><p> Finally the ROM solution is reconstructed. In the case the solution should be exported and exported, put true instead of false in the function:</p>
<div class="fragment"><div class="line">    reduced.reconstruct(<span class="keyword">false</span>, <span class="stringliteral">&quot;./ITHACAoutput/Reconstruction/&quot;</span>);</div>
</div><!-- fragment --> <h1><a class="anchor" id="plaincode"></a>
The plain program</h1>
<p>Here there's the plain code</p>
<div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div>
<div class="line"><span class="comment">     âââââââââââââââ  âââ ââââââ  âââââââ ââââââ       âââââââââââ   âââ</span></div>
<div class="line"><span class="comment">     âââââââââââââââ  âââââââââââââââââââââââââââ      âââââââââââ   âââ</span></div>
<div class="line"><span class="comment">     âââ   âââ   âââââââââââââââââââ     ââââââââââââââââââââ  âââ   âââ</span></div>
<div class="line"><span class="comment">     âââ   âââ   âââââââââââââââââââ     ââââââââââââââââââââ  ââââ ââââ</span></div>
<div class="line"><span class="comment">     âââ   âââ   âââ  ââââââ  ââââââââââââââ  âââ      âââ      âââââââ</span></div>
<div class="line"><span class="comment">     âââ   âââ   âââ  ââââââ  âââ ââââââââââ  âââ      âââ       âââââ</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> * In real Time Highly Advanced Computational Applications for Finite Volumes</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2021 by the ITHACA-FV authors</span></div>
<div class="line"><span class="comment">-------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">License</span></div>
<div class="line"><span class="comment">    This file is part of ITHACA-FV</span></div>
<div class="line"><span class="comment">    ITHACA-FV is free software: you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">    it under the terms of the GNU Lesser General Public License as published by</span></div>
<div class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><span class="comment">    (at your option) any later version.</span></div>
<div class="line"><span class="comment">    ITHACA-FV is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div>
<div class="line"><span class="comment">    GNU Lesser General Public License for more details.</span></div>
<div class="line"><span class="comment">    You should have received a copy of the GNU Lesser General Public License</span></div>
<div class="line"><span class="comment">    along with ITHACA-FV. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">Description</span></div>
<div class="line"><span class="comment">    Example of an unsteady NS Reduction Problem with time-dependent boundary</span></div>
<div class="line"><span class="comment">    conditions.</span></div>
<div class="line"><span class="comment">SourceFiles</span></div>
<div class="line"><span class="comment">    17YJunction.C</span></div>
<div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="unsteadyNS_8H.html">unsteadyNS.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ReducedUnsteadyNS_8H.html">ReducedUnsteadyNS.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code" href="classtutorial17.html">tutorial17</a>: <span class="keyword">public</span> <a class="code" href="classunsteadyNS.html">unsteadyNS</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        <span class="keyword">explicit</span> <a class="code" href="classtutorial17.html#a11de25dfeaff748b8dada5ba0c551297">tutorial17</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">            :</div>
<div class="line">            <a class="code" href="classunsteadyNS.html#a94671a2e15e331569938cb3bd4fb5ba7">unsteadyNS</a>(argc, argv),</div>
<div class="line">            <a name="a39"></a><a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div>
<div class="line">            <a name="a40"></a><a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a>(<a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>())</div>
<div class="line">        {}</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Fields To Perform</span></div>
<div class="line">        volVectorField&amp; <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>;</div>
<div class="line">        volScalarField&amp; <a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classtutorial17.html#a72ab84b213b6dce9d235c40bd604cd2c">offlineSolve</a>()</div>
<div class="line">        {</div>
<div class="line">            List&lt;scalar&gt; mu_now(1);</div>
<div class="line">            volVectorField <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4a67efa51a0845eff228b219d8dc81a">U0</a> = <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>;</div>
<div class="line">            volScalarField P0 = <a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div>
<div class="line">                <a class="code" href="namespaceITHACAstream.html#a23375000c57c5151da30c6be9284b764">ITHACAstream::read_fields</a>(<a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>, <a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a> = <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#ae4a67efa51a0845eff228b219d8dc81a">U0</a>;</div>
<div class="line">                <a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a> = P0;</div>
<div class="line">                mu_now[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, 0);</div>
<div class="line">                <a class="code" href="classreductionProblem.html#aeab985e1958591a9de375c415c8d5e8d">truthSolve</a>(mu_now);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Method to compute the lifting functions for this tutorial</span></div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classsteadyNS.html#af11a2fa8637db86b8b129ee9d84de091">liftSolve</a>(Eigen::MatrixXd BCs)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (label k = 0; k &lt; <a class="code" href="classreductionProblem.html#a0e07dd8aeee6491275df8034e723de95">inletPatch</a>.rows(); k++)</div>
<div class="line">            {</div>
<div class="line">                Time&amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a> = <a class="code" href="classsteadyNS.html#a4493d1f1ce7e2008c85b1dde7c027de4">_runTime</a>();</div>
<div class="line">                surfaceScalarField&amp; <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> = <a name="a41"></a><a class="code" href="classsteadyNS.html#a27dd336cf3b9757ba406b3d3926ac299">_phi</a>();</div>
<div class="line">                fvMesh&amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a> = <a class="code" href="classsteadyNS.html#a6a233a5c129864684e67e41d04983e01">_mesh</a>();</div>
<div class="line">                volScalarField <a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a> = <a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>();</div>
<div class="line">                volVectorField <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a> = <a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>();</div>
<div class="line">                IOMRFZoneList&amp; MRF = <a name="a42"></a><a class="code" href="classsteadyNS.html#a99bd483228d60f47cd8ed4ed61a57472">_MRF</a>();</div>
<div class="line">                label BCind = <a class="code" href="classreductionProblem.html#a0e07dd8aeee6491275df8034e723de95">inletPatch</a>(k, 0);</div>
<div class="line">                volVectorField Ulift(<span class="stringliteral">&quot;Ulift&quot;</span> + name(k), <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>);</div>
<div class="line">                instantList Times = <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.times();</div>
<div class="line">                <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.setTime(Times[1], 1);</div>
<div class="line">                pisoControl potentialFlow(<a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>, <span class="stringliteral">&quot;potentialFlow&quot;</span>);</div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Solving a lifting Problem&quot;</span> &lt;&lt; endl;</div>
<div class="line">                Vector&lt;double&gt; v1(0, 0, 0);</div>
<div class="line">                v1[0] = BCs(0, k);</div>
<div class="line">                v1[1] = BCs(1, k);</div>
<div class="line">                Vector&lt;double&gt; <a class="code" href="msrProblem_2createConstants_8H.html#a5cb9477af496b1370b25434b206c736e">v0</a>(0, 0, 0);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (label j = 0; j &lt; <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>.boundaryField().size(); j++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (j == BCind)</div>
<div class="line">                    {</div>
<div class="line">                        <a name="a43"></a><a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(Ulift, j, v1);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>.boundaryField()[BCind].type() == <span class="stringliteral">&quot;fixedValue&quot;</span>)</div>
<div class="line">                    {</div>
<div class="line">                        <a class="code" href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">assignBC</a>(Ulift, j, <a class="code" href="msrProblem_2createConstants_8H.html#a5cb9477af496b1370b25434b206c736e">v0</a>);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <a name="a44"></a><a class="code" href="classreductionProblem.html#a5c9c99f98e576423c196093a72e2ce98">assignIF</a>(Ulift, <a class="code" href="msrProblem_2createConstants_8H.html#a5cb9477af496b1370b25434b206c736e">v0</a>);</div>
<div class="line">                    <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> = linearInterpolate(Ulift) &amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.Sf();</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Constructing velocity potential field Phi\n&quot;</span> &lt;&lt; endl;</div>
<div class="line">                volScalarField Phi</div>
<div class="line">                (</div>
<div class="line">                    IOobject</div>
<div class="line">                    (</div>
<div class="line">                        <span class="stringliteral">&quot;Phi&quot;</span>,</div>
<div class="line">                        <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.timeName(),</div>
<div class="line">                        <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>,</div>
<div class="line">                        IOobject::READ_IF_PRESENT,</div>
<div class="line">                        IOobject::NO_WRITE</div>
<div class="line">                    ),</div>
<div class="line">                    <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>,</div>
<div class="line">                    dimensionedScalar(<span class="stringliteral">&quot;Phi&quot;</span>, dimLength * dimVelocity, 0),</div>
<div class="line">                    <a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a>.boundaryField().types()</div>
<div class="line">                );</div>
<div class="line">                label PhiRefCell = 0;</div>
<div class="line">                scalar PhiRefValue = 0;</div>
<div class="line">                <a class="code" href="src_2ITHACA__FOMPROBLEMS_2msrProblem_2createFields_8H.html#afeb00419cfdbd69ab20e430caf6e541b">setRefCell</a></div>
<div class="line">                (</div>
<div class="line">                    Phi,</div>
<div class="line">                    potentialFlow.dict(),</div>
<div class="line">                    PhiRefCell,</div>
<div class="line">                    PhiRefValue</div>
<div class="line">                );</div>
<div class="line">                <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.setFluxRequired(Phi.name());</div>
<div class="line">                <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createTime_8H.html#a477812c93e1698f206b3c3266041d0fd">runTime</a>.functionObjects().start();</div>
<div class="line">                MRF.makeRelative(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>);</div>
<div class="line">                <a class="code" href="msrProblem_2pEqn_8H.html#a2763a4e809e5ae1f9caf5fb4bc42a66e">adjustPhi</a>(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>, Ulift, <a class="code" href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">p</a>);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">while</span> (potentialFlow.correctNonOrthogonal())</div>
<div class="line">                {</div>
<div class="line">                    fvScalarMatrix PhiEqn</div>
<div class="line">                    (</div>
<div class="line">                        fvm::laplacian(dimensionedScalar(<span class="stringliteral">&quot;1&quot;</span>, dimless, 1), Phi)</div>
<div class="line">                        ==</div>
<div class="line">                        fvc::div(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>)</div>
<div class="line">                    );</div>
<div class="line">                    PhiEqn.setReference(PhiRefCell, PhiRefValue);</div>
<div class="line">                    PhiEqn.solve();</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (potentialFlow.finalNonOrthogonalIter())</div>
<div class="line">                    {</div>
<div class="line">                        <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a> -= PhiEqn.flux();</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                MRF.makeAbsolute(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>);</div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Continuity error = &quot;</span></div>
<div class="line">                     &lt;&lt; mag(fvc::div(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>))().weightedAverage(<a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.V()).value()</div>
<div class="line">                     &lt;&lt; endl;</div>
<div class="line">                Ulift = fvc::reconstruct(<a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>);</div>
<div class="line">                Ulift.correctBoundaryConditions();</div>
<div class="line">                Info &lt;&lt; <span class="stringliteral">&quot;Interpolated velocity error = &quot;</span></div>
<div class="line">                     &lt;&lt; (sqrt(sum(sqr((fvc::interpolate(<a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>) &amp; <a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.Sf()) - <a class="code" href="msrProblem_2createPhi_8H.html#a1a97abcf6c141f539994c8a21c8daca7">phi</a>)))</div>
<div class="line">                         / sum(<a class="code" href="ITHACA__CORE_2ITHACAsensitivity_2FiguresOfMerit_2createMesh_8H.html#ad3874bb3b9ab8a24930b4793e928108d">mesh</a>.magSf())).value()</div>
<div class="line">                     &lt;&lt; endl;</div>
<div class="line">                Ulift.write();</div>
<div class="line">                volVectorField Uzero</div>
<div class="line">                (</div>
<div class="line">                    IOobject</div>
<div class="line">                    (</div>
<div class="line">                        <span class="stringliteral">&quot;Uzero&quot;</span>,</div>
<div class="line">                        <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>.time().timeName(),</div>
<div class="line">                        <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>.mesh(),</div>
<div class="line">                        IOobject::NO_READ,</div>
<div class="line">                        IOobject::AUTO_WRITE</div>
<div class="line">                    ),</div>
<div class="line">                    <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>.mesh(),</div>
<div class="line">                    dimensionedVector(<span class="stringliteral">&quot;zero&quot;</span>, <a class="code" href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">U</a>.dimensions(), vector::zero)</div>
<div class="line">                );</div>
<div class="line">                volVectorField Uliftx(<span class="stringliteral">&quot;Uliftx&quot;</span> + name(k), Uzero);</div>
<div class="line">                Uliftx.replace(0, Ulift.component(0));</div>
<div class="line">                Uliftx.write();</div>
<div class="line">                <a class="code" href="classsteadyNS.html#a6e6f9d485657cc2c1fea709aa8ad5ec9">liftfield</a>.append((Uliftx).clone());</div>
<div class="line">                volVectorField Ulifty(<span class="stringliteral">&quot;Ulifty&quot;</span> + name(k), Uzero);</div>
<div class="line">                Ulifty.replace(1, Ulift.component(1));</div>
<div class="line">                Ulifty.write();</div>
<div class="line">                <a class="code" href="classsteadyNS.html#a6e6f9d485657cc2c1fea709aa8ad5ec9">liftfield</a>.append((Ulifty).clone());</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div>
<div class="line"><span class="comment">                               Starting the MAIN</span></div>
<div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div>
<div class="line"><span class="keywordtype">int</span> <a name="a45"></a><a class="code" href="17YJunction_8C.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Construct the tutorial17 object</span></div>
<div class="line">    <a class="code" href="classtutorial17.html">tutorial17</a> example(argc, argv);</div>
<div class="line">    <span class="comment">// the offline samples for the boundary conditions</span></div>
<div class="line">    word par_offline_BC(<span class="stringliteral">&quot;./timeBCoff&quot;</span>);</div>
<div class="line">    <span class="comment">// Convert boundary values x-direction and y-direction to x,y,z</span></div>
<div class="line">    Eigen::MatrixXd timeBCoff2D = <a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_offline_BC);</div>
<div class="line">    Eigen::MatrixXd timeBCoff3D = Eigen::MatrixXd::Zero(6, timeBCoff2D.cols());</div>
<div class="line">    timeBCoff3D.row(0) = timeBCoff2D.row(0);</div>
<div class="line">    timeBCoff3D.row(1) = timeBCoff2D.row(1);</div>
<div class="line">    timeBCoff3D.row(3) = timeBCoff2D.row(2);</div>
<div class="line">    timeBCoff3D.row(4) = timeBCoff2D.row(3);</div>
<div class="line">    example.timeBCoff = timeBCoff3D;</div>
<div class="line">    Eigen::MatrixXd par_on_BC;</div>
<div class="line">    word par_online_BC(<span class="stringliteral">&quot;./timeBCon&quot;</span>);</div>
<div class="line">    par_on_BC = <a class="code" href="namespaceITHACAstream.html#aa259fffbddd2f4a42cc3a4a76f839ef6">ITHACAstream::readMatrix</a>(par_online_BC);</div>
<div class="line">    <span class="comment">// Read parameters from ITHACAdict file</span></div>
<div class="line">    <a class="code" href="classITHACAparameters.html">ITHACAparameters</a>* para = <a class="code" href="classITHACAparameters.html#adf4e7e15954b8779d57ed6478a19027f">ITHACAparameters::getInstance</a>(example._mesh(),</div>
<div class="line">                             example._runTime());</div>
<div class="line">    <span class="keywordtype">int</span> NmodesUout = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUout&quot;</span>, 15);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesPout = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPout&quot;</span>, 15);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesSUPout = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPout&quot;</span>, 15);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesUproj = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUproj&quot;</span>, 10);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesPproj = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPproj&quot;</span>, 10);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesSUPproj = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPproj&quot;</span>, 10);</div>
<div class="line">    <span class="keywordtype">int</span> NmodesOut = para-&gt;<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesOut&quot;</span>, 20);</div>
<div class="line">    example.Pnumber = 1;</div>
<div class="line">    example.Tnumber = 1;</div>
<div class="line">    example.setParameters();</div>
<div class="line">    <span class="comment">// Set the parameter ranges</span></div>
<div class="line">    example.mu_range(0, 0) = 0.01;</div>
<div class="line">    example.mu_range(0, 1) = 0.01;</div>
<div class="line">    <span class="comment">// Generate equispaced samples inside the parameter range</span></div>
<div class="line">    example.genEquiPar();</div>
<div class="line">    <span class="comment">// Set the inlet boundaries where we have non homogeneous boundary conditions</span></div>
<div class="line">    example.inletIndex.resize(4, 2); <span class="comment">// rows: total number of patches</span></div>
<div class="line">    example.inletIndex(0, 0) = 1;  <span class="comment">// Patch inlet 1</span></div>
<div class="line">    example.inletIndex(0, 1) = 0;  <span class="comment">// Patch inlet 1: x-direction</span></div>
<div class="line">    example.inletIndex(1, 0) = 1;  <span class="comment">// Patch inlet 1: y-direction</span></div>
<div class="line">    example.inletIndex(1, 1) = 1;  <span class="comment">// Patch inlet 2</span></div>
<div class="line">    example.inletIndex(2, 0) = 2;  <span class="comment">// Patch inlet 2: x-direction</span></div>
<div class="line">    example.inletIndex(2, 1) = 0;  <span class="comment">// Patch inlet 2: y-direction</span></div>
<div class="line">    example.inletIndex(3, 0) = 2;  <span class="comment">// Patch inlet 2: x-direction</span></div>
<div class="line">    example.inletIndex(3, 1) = 1;  <span class="comment">// Patch inlet 2: y-direction</span></div>
<div class="line">    example.inletPatch.resize(2, 1);</div>
<div class="line">    example.inletPatch(0, 0) = example.inletIndex(0, 0);  <span class="comment">// Patch inlet 1</span></div>
<div class="line">    example.inletPatch(1, 0) = example.inletIndex(2, 0);  <span class="comment">// Patch inlet 2</span></div>
<div class="line">    <span class="comment">// Time parameters</span></div>
<div class="line">    example.startTime = 0;</div>
<div class="line">    example.finalTime = 12;</div>
<div class="line">    example.timeStep = 0.0005;</div>
<div class="line">    example.writeEvery = 0.03;</div>
<div class="line">    <span class="comment">// Perform The Offline Solve;</span></div>
<div class="line">    example.offlineSolve();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Perform POD</span></div>
<div class="line">    <span class="keywordflow">if</span> (example.bcMethod == <span class="stringliteral">&quot;lift&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Search the lift function</span></div>
<div class="line">        Eigen::MatrixXd BCs;</div>
<div class="line">        BCs.resize(2, 2);</div>
<div class="line">        BCs(0, 0) = 1;  <span class="comment">// Patch inlet 1</span></div>
<div class="line">        BCs(1, 0) = -1;  <span class="comment">// Patch inlet 2</span></div>
<div class="line">        BCs(0, 1) = 1;  <span class="comment">// Patch inlet 1</span></div>
<div class="line">        BCs(1, 1) = 1;  <span class="comment">// Patch inlet 2</span></div>
<div class="line">        example.liftSolve(BCs);</div>
<div class="line">        <span class="comment">// Normalize the lifting function</span></div>
<div class="line">        <a class="code" href="namespaceITHACAutilities.html#a8793ffd94679609166b4bd53f3496b9c">ITHACAutilities::normalizeFields</a>(example.liftfield);</div>
<div class="line">        <span class="comment">// Create homogeneous basis functions for velocity</span></div>
<div class="line">        example.computeLift(example.Ufield, example.liftfield, example.Uomfield);</div>
<div class="line">        <span class="comment">// Perform a POD decomposition for velocity and pressure</span></div>
<div class="line">        <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Uomfield, example.Umodes, example._U().name(),</div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesUout);</div>
<div class="line">        <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example._p().name(),</div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesPout);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (example.bcMethod == <span class="stringliteral">&quot;penalty&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Perform a POD decomposition for velocity and pressure</span></div>
<div class="line">        <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Ufield, example.Umodes, example._U().name(),</div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesUout);</div>
<div class="line">        <a class="code" href="namespaceITHACAPOD.html#a7c9767253fcbf4c4f0ea01c0a071672f">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example._p().name(),</div>
<div class="line">                            example.podex, 0, 0,</div>
<div class="line">                            NmodesPout);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Reduced Matrices</span></div>
<div class="line">    example.projectPPE(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesUproj, NmodesPproj, NmodesSUPproj);</div>
<div class="line">    <a class="code" href="classreducedUnsteadyNS.html">reducedUnsteadyNS</a> reduced(example);</div>
<div class="line">    <span class="comment">// Set values of the online phase</span></div>
<div class="line">    reduced.nu = 0.01;</div>
<div class="line">    reduced.tstart = 0;</div>
<div class="line">    reduced.finalTime = 18;</div>
<div class="line">    reduced.dt = 0.0005;</div>
<div class="line">    reduced.storeEvery = 0.0005;</div>
<div class="line">    reduced.exportEvery = 0.03;</div>
<div class="line">    <span class="comment">// Set values velocity boundary conditions of the online phase</span></div>
<div class="line">    Eigen::MatrixXd vel_now = par_on_BC;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (example.bcMethod == <span class="stringliteral">&quot;penalty&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Set values of the iterative penalty method</span></div>
<div class="line">        reduced.maxIterPenalty = 100;</div>
<div class="line">        reduced.tolerancePenalty = 1e-5;</div>
<div class="line">        reduced.timeStepPenalty = 5;</div>
<div class="line">        <span class="comment">// Set initial quess for penalty factors</span></div>
<div class="line">        reduced.tauIter = Eigen::MatrixXd::Zero(4, 1);</div>
<div class="line">        reduced.tauIter &lt;&lt;  1e-6, 1e-6, 1e-6, 1e-6;</div>
<div class="line">        <span class="comment">// Solve for the penalty factors with the iterative solver</span></div>
<div class="line">        reduced.tauU = reduced.penalty_PPE(vel_now, reduced.tauIter);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set the online temperature BC and solve reduced model</span></div>
<div class="line">    reduced.solveOnline_PPE(vel_now);</div>
<div class="line">    reduced.reconstruct(<span class="keyword">false</span>, <span class="stringliteral">&quot;./ITHACAoutput/Reconstruction/&quot;</span>);</div>
<div class="line">    exit(0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="ttc" id="a17YJunction_8C_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="17YJunction_8C.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="17YJunction_8C_source.html#l00198">17YJunction.C:198</a></div></div>
<div class="ttc" id="aclassreductionProblem_html_a58ac7e74dd757c1e96bffead2b49ec80"><div class="ttname"><a href="classreductionProblem.html#a58ac7e74dd757c1e96bffead2b49ec80">reductionProblem::assignBC</a></div><div class="ttdeci">void assignBC(volVectorField &amp;s, label BC_ind, Vector&lt; double &gt; &amp;value)</div><div class="ttdoc">Assign Boundary Condition to a volVectorField.</div><div class="ttdef"><b>Definition:</b> <a href="reductionProblem_8C_source.html#l00160">reductionProblem.C:160</a></div></div>
<div class="ttc" id="aclassreductionProblem_html_a5c9c99f98e576423c196093a72e2ce98"><div class="ttname"><a href="classreductionProblem.html#a5c9c99f98e576423c196093a72e2ce98">reductionProblem::assignIF</a></div><div class="ttdeci">void assignIF(T &amp;s, G &amp;value)</div><div class="ttdoc">Assign internal field condition.</div><div class="ttdef"><b>Definition:</b> <a href="reductionProblemTemplates_8C_source.html#l00034">reductionProblemTemplates.C:34</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a27dd336cf3b9757ba406b3d3926ac299"><div class="ttname"><a href="classsteadyNS.html#a27dd336cf3b9757ba406b3d3926ac299">steadyNS::_phi</a></div><div class="ttdeci">autoPtr&lt; surfaceScalarField &gt; _phi</div><div class="ttdoc">Flux.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00296">steadyNS.H:296</a></div></div>
<div class="ttc" id="aclasssteadyNS_html_a99bd483228d60f47cd8ed4ed61a57472"><div class="ttname"><a href="classsteadyNS.html#a99bd483228d60f47cd8ed4ed61a57472">steadyNS::_MRF</a></div><div class="ttdeci">autoPtr&lt; IOMRFZoneList &gt; _MRF</div><div class="ttdoc">MRF variable.</div><div class="ttdef"><b>Definition:</b> <a href="steadyNS_8H_source.html#l00308">steadyNS.H:308</a></div></div>
<div class="ttc" id="aclasstutorial17_html_a758f981c68316498d451c7b833c14b04"><div class="ttname"><a href="classtutorial17.html#a758f981c68316498d451c7b833c14b04">tutorial17::p</a></div><div class="ttdeci">volScalarField &amp; p</div><div class="ttdef"><b>Definition:</b> <a href="17YJunction_8C_source.html#l00050">17YJunction.C:50</a></div></div>
<div class="ttc" id="aclasstutorial17_html_a77a07ed6b7142480501f28b0f32f9d7e"><div class="ttname"><a href="classtutorial17.html#a77a07ed6b7142480501f28b0f32f9d7e">tutorial17::U</a></div><div class="ttdeci">volVectorField &amp; U</div><div class="ttdef"><b>Definition:</b> <a href="17YJunction_8C_source.html#l00049">17YJunction.C:49</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small></address>
</body>
</html>
