<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ITHACA-FV: 04unsteadyNS.C</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ithaca-fv-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="">ITHACA-FV</a>
   &#160;<span id="projectnumber"><a href="">5.0</a></span>
   </div>
   <div id="projectbrief"><a href="https://mathlab.sissa.it/">SISSA mathLab</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">04unsteadyNS.C</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="intro_unsreadyNS"></a>
Introduction to tutorial 4</h1>
<p>In this tutorial we implement a parametrized unsteady Navier-Stokes 2D problem where the parameter is the kinematic viscosity. The physical problem represents an incompressible flow passing around a very long cylinder. The simulation domain is rectangular with spatial bounds of [-4, 30], and [-5, 5] in the X and Y directions, respectively. The cylinder has a radius of 0.5 unit length and is located at the origin. The system has a prescribed uniform inlet velocity of 1 m/s which is constant through the whole simulation.</p>
<p>The following image illustrates the simulated system at time = 50 s and Re = 100. </p><div class="image">
<img src="cylinder.png" alt="cylinder.png"/>
</div>
<h1><a class="anchor" id="code04"></a>
A detailed look into the code</h1>
<p>In this section we explain the main steps necessary to construct the tutorial N°4</p>
<h2><a class="anchor" id="header"></a>
The necessary header files</h2>
<p>First of all let's have a look at the header files that need to be included and what they are responsible for.</p>
<p>The header files of ITHACA-FV necessary for this tutorial are: &lt;<a class="el" href="unsteadyNS_8H.html" title="Header file of the unsteadyNS class. ">unsteadyNS.H</a>&gt; for the full order unsteady NS problem, &lt;<a class="el" href="ITHACAPOD_8H.html" title="Header file of the ITHACAPOD class. ">ITHACAPOD.H</a>&gt; for the POD decomposition, &lt;<a class="el" href="reducedUnsteadyNS_8H.html" title="Header file of the reducedUnsteadyNS class. ">reducedUnsteadyNS.H</a>&gt; for the construction of the reduced order problem, and finally &lt;<a class="el" href="ITHACAstream_8H.html" title="Header file of the ITHACAstream class, it contains the implementation of several methods for input ou...">ITHACAstream.H</a>&gt; for some ITHACA input-output operations.</p>
 <div class="fragment"><div class="line">    04<a name="_a0"></a><a class="code" href="classunsteadyNS.html">unsteadyNS</a>.C</div><div class="line">\*---------------------------------------------------------------------------*/</div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="unsteadyNS_8H.html">unsteadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reducedUnsteadyNS_8H.html">reducedUnsteadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div></div><!-- fragment --></p>
<h2><a class="anchor" id="classtutorial04"></a>
Definition of the tutorial04 class</h2>
<p>We define the <a class="el" href="classtutorial04.html">tutorial04</a> class as a child of the <a class="el" href="classunsteadyNS.html" title="Implementation of a parametrized full order  unsteady NS problem  and preparation of the the reduced ...">unsteadyNS</a> class. The constructor is defined with members that are the fields need to be manipulated during the resolution of the full order problem using pimpleFoam. Such fields are also initialized with the same initial conditions in the solver. <div class="fragment"><div class="line"><span class="keyword">class </span><a name="_a1"></a><a class="code" href="classtutorial04.html">tutorial04</a>: <span class="keyword">public</span> <a class="code" href="classunsteadyNS.html">unsteadyNS</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">explicit</span> <a name="a2"></a><a class="code" href="classtutorial04.html#a381d5e381959df54e8e6f8d05084693d">tutorial04</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">        :</div><div class="line">        <a name="a3"></a><a class="code" href="classunsteadyNS.html#a94671a2e15e331569938cb3bd4fb5ba7">unsteadyNS</a>(argc, argv),</div><div class="line">        <a name="a4"></a><a class="code" href="src_2problems_2steadyNS_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>(<a name="a5"></a><a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div><div class="line">        <a name="a6"></a><a class="code" href="src_2problems_2steadyNS_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>(<a name="a7"></a><a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>())</div><div class="line">    {}</div></div><!-- fragment --></p>
<p>Inside the <a class="el" href="classtutorial04.html">tutorial04</a> class we define the offlineSolve method according to the specific parametrized problem that needs to be solved. If the offline solve has been previously performed then the method just reads the existing snapshots from the Offline directory. Otherwise it loops over all the parameters, changes the system viscosity with the iterable parameter then performs the offline solve.</p>
<p><div class="fragment"><div class="line">    <span class="keywordtype">void</span> <a name="a8"></a><a class="code" href="classtutorial04.html#a77204ed6266f44aad66503d46b81b917">offlineSolve</a>()</div><div class="line">    {</div><div class="line">        Vector&lt;double&gt; inl(0, 0, 0);</div><div class="line">        label BCind = 1;</div><div class="line">        List&lt;scalar&gt; mu_now(1);</div><div class="line">        Info &lt;&lt; <span class="stringliteral">&quot;here&quot;</span> &lt;&lt; endl;</div><div class="line">        <span class="keywordflow">if</span> (<a name="a9"></a><a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div><div class="line">        {</div><div class="line">            <a name="a10"></a><a class="code" href="classITHACAstream.html#a7fbeebc9ef783c3fbaffac04f18ccd4d">ITHACAstream::read_fields</a>(<a name="a11"></a><a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="src_2problems_2steadyNS_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">            <a class="code" href="classITHACAstream.html#a7fbeebc9ef783c3fbaffac04f18ccd4d">ITHACAstream::read_fields</a>(<a name="a12"></a><a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>, <a class="code" href="src_2problems_2steadyNS_2createFields_8H.html#a334650304cdcdff41898bee9eaf2e3db">p</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">for</span> (label <a name="a13"></a><a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a name="a14"></a><a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.cols(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">            {</div><div class="line">                inl[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line">                mu_now[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line">                <span class="comment">//assignBC(U, BCind, inl);</span></div><div class="line">                <a name="a15"></a><a class="code" href="classreductionProblem.html#a5c9c99f98e576423c196093a72e2ce98">assignIF</a>(<a class="code" href="src_2problems_2steadyNS_2createFields_8H.html#ae4919c063fc0646445cdcafee89ebd60">U</a>, inl);</div><div class="line">                <a name="a16"></a><a class="code" href="classsteadyNS.html#a0bef04380f3d0e8e1a8e6fc18ddc056c">change_viscosity</a>( <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line">                <a name="a17"></a><a class="code" href="classsteadyNS.html#acff4dd4ea902cfdcbda57897f59c2e13">truthSolve</a>(mu_now);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div></div><!-- fragment --></p>
<p>We note that in the commented line we show that it is possible to parametrize the boundary conditions. For further details we refer to the classes: <a class="el" href="classreductionProblem.html" title="A general class for the implementation of a full order parametrized problem. ">reductionProblem</a>, and <a class="el" href="classunsteadyNS.html" title="Implementation of a parametrized full order  unsteady NS problem  and preparation of the the reduced ...">unsteadyNS</a>.</p>
<h2><a class="anchor" id="main"></a>
Definition of the main function</h2>
<p>In this section we show the definition of the main function. First we construct the object "example" of type <a class="el" href="classtutorial04.html">tutorial04</a>:</p>
<p><div class="fragment"><div class="line">    <a class="code" href="classtutorial04.html">tutorial04</a> example(argc, argv);</div></div><!-- fragment --></p>
<p>Then we parse the ITHACAdict file to determine the number of modes to be written out and also the ones to be used for projection of the velocity, pressure, and the supremizer: <div class="fragment"><div class="line">    <a name="_a18"></a><a class="code" href="classITHACAparameters.html">ITHACAparameters</a> para;</div><div class="line">    <span class="keywordtype">int</span> NmodesUout = para.<a name="a19"></a><a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUout&quot;</span>, 15);</div><div class="line">    <span class="keywordtype">int</span> NmodesPout = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPout&quot;</span>, 15);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUPout = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPout&quot;</span>, 15);</div><div class="line">    <span class="keywordtype">int</span> NmodesUproj = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUproj&quot;</span>, 10);</div><div class="line">    <span class="keywordtype">int</span> NmodesPproj = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPproj&quot;</span>, 10);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUPproj = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPproj&quot;</span>, 10);</div></div><!-- fragment --></p>
<p>we note that a default value can be assigned in case the parser did not find the corresponding string in the ITHACAdict file.</p>
<p>Now we would like to perform 10 parametrized simulations where the kinematic viscosity is the sole parameter to change, and it lies in the range of {0.1, 0.01} m^2/s equispaced. Alternatively, we can also think of those simulations as that they are performed for fluid flow that has Re changes from Re=10 to Re=100 with step size = 10. In fact, both definitions are the same since the inlet velocity and the domain geometry are both kept fixed through all simulations.</p>
<p>In our implementation, the parameter (viscosity) can be defined by specifying that Nparameters=1, Nsamples=10, and the parameter ranges from 0.1 to 0.01 equispaced, i.e.</p>
<p><div class="fragment"><div class="line">    example.Pnumber = 1;</div><div class="line">    example.Tnumber = 10;</div><div class="line">    example.setParameters();</div><div class="line">    <span class="comment">// Set the parameter ranges</span></div><div class="line">    example.mu_range(0, 0) = 0.1;</div><div class="line">    example.mu_range(0, 1) = 0.01;</div><div class="line">    <span class="comment">// Generate equispaced samples inside the parameter range</span></div><div class="line">    example.genEquiPar();</div></div><!-- fragment --></p>
<p>After that we set the inlet boundaries where we have the non homogeneous BC:</p>
<p><div class="fragment"><div class="line">    example.inletIndex.resize(1, 2);</div><div class="line">    example.inletIndex(0, 0) = 0;</div><div class="line">    example.inletIndex(0, 1) = 0;</div></div><!-- fragment --></p>
<p>And we set the parameters for the time integration, so as to simulate 20 seconds for each simulation, with a step size = 0.01 seconds, and the data are dumped every 1.0 seconds, i.e.</p>
<p><div class="fragment"><div class="line">    example.startTime = 0;</div><div class="line">    example.finalTime = 20;</div><div class="line">    example.timeStep = 0.01;</div><div class="line">    example.writeEvery = 1.0;</div></div><!-- fragment --></p>
<p>Now we are ready to perform the offline stage:</p>
<p><div class="fragment"><div class="line">    example.offlineSolve();</div></div><!-- fragment --></p>
<p>and to solve the supremizer problem:</p>
<p><div class="fragment"><div class="line">    example.solvesupremizer();</div></div><!-- fragment --></p>
<p>In order to search and compute the lifting function (which should be a step function of value equals to the unitary inlet velocity), we perform the following:</p>
<p><div class="fragment"><div class="line">    example.liftSolve();</div></div><!-- fragment --></p>
<p>Then we create homogenuous basis functions for the velocity:</p>
<p><div class="fragment"><div class="line">    example.computeLift(example.Ufield, example.liftfield, example.Uomfield);</div></div><!-- fragment --></p>
<p>After that, the modes for velocity, pressure and supremizers are obtained:</p>
<p><div class="fragment"><div class="line">    <a name="a20"></a><a class="code" href="classITHACAPOD.html#a6d9df3a9aae4b7a746b5b992f36d16d3">ITHACAPOD::getModes</a>(example.Uomfield, example.Umodes, example.podex, 0, 0, NmodesUout);</div><div class="line">    <a class="code" href="classITHACAPOD.html#a6d9df3a9aae4b7a746b5b992f36d16d3">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example.podex, 0, 0, NmodesPout);</div><div class="line">    <a class="code" href="classITHACAPOD.html#a6d9df3a9aae4b7a746b5b992f36d16d3">ITHACAPOD::getModes</a>(example.supfield, example.supmodes, example.podex, example.supex, 1, NmodesSUPout);</div></div><!-- fragment --></p>
<p>then the projection onto the POD modes is performed with:</p>
<p><div class="fragment"><div class="line">    example.projectSUP(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesUproj, NmodesPproj, NmodesSUPproj);</div></div><!-- fragment --></p>
<p>Now that we obtained all the necessary information from the POD decomposition and the reduced matrices, we are now ready to construct the dynamical system for the reduced order model (ROM). We proceed by constructing the object "reduced" of type <a class="el" href="classreducedUnsteadyNS.html" title="Class where it is implemented a reduced problem for the  unsteady Navier-stokes  problem. ">reducedUnsteadyNS</a>:</p>
<p><div class="fragment"><div class="line">    <a name="_a21"></a><a class="code" href="classreducedUnsteadyNS.html">reducedUnsteadyNS</a> reduced(example);</div></div><!-- fragment --></p>
<p>And then we can use the new constructed ROM to perform the online procedure, from which we can simulate the problem at new set of parameters. For instance, we solve the problem with a viscosity=0.055 for a 15 seconds of physical time:</p>
<p><div class="fragment"><div class="line">    reduced.nu = 0.055;</div><div class="line">    reduced.tstart = 0;</div><div class="line">    reduced.finalTime = 15;</div><div class="line">    reduced.dt = 0.01;</div></div><!-- fragment --></p>
<p>and then the online solve is performed. In this tutorial, the value of the online velocity is in fact a multiplication factor of the step lifting function for the unitary inlet velocity. Therefore the online velocity sets the new BC at the inlet, hence we solve the ROM at new BC.</p>
<p><div class="fragment"><div class="line">    Eigen::MatrixXd vel_now(1, 1);</div><div class="line">    vel_now(0, 0) = 2;</div><div class="line">    reduced.solveOnline_sup(vel_now);</div></div><!-- fragment --></p>
<p>Finally the ROM solution is reconstructed and exported:</p>
<p><div class="fragment"><div class="line">    reduced.reconstruct_sup(<span class="stringliteral">&quot;./ITHACAoutput/ReconstructionSUP/&quot;</span>, 5);</div></div><!-- fragment --></p>
<p>We note that all the previous evaluations of the pressure were based on the supremizers approach. We can also use the Pressure Poisson Equation (PPE) instead of SUP so as to be implemented for the projections, the online solve, and the fields reconstructions.</p>
<h1><a class="anchor" id="plaincode"></a>
The plain program</h1>
<p>Here there's the plain code</p>
<div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div><div class="line"><span class="comment">     ██╗████████╗██╗  ██╗ █████╗  ██████╗ █████╗       ███████╗██╗   ██╗</span></div><div class="line"><span class="comment">     ██║╚══██╔══╝██║  ██║██╔══██╗██╔════╝██╔══██╗      ██╔════╝██║   ██║</span></div><div class="line"><span class="comment">     ██║   ██║   ███████║███████║██║     ███████║█████╗█████╗  ██║   ██║</span></div><div class="line"><span class="comment">     ██║   ██║   ██╔══██║██╔══██║██║     ██╔══██║╚════╝██╔══╝  ╚██╗ ██╔╝</span></div><div class="line"><span class="comment">     ██║   ██║   ██║  ██║██║  ██║╚██████╗██║  ██║      ██║      ╚████╔╝ </span></div><div class="line"><span class="comment">     ╚═╝   ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝      ╚═╝       ╚═══╝  </span></div><div class="line"><span class="comment"> </span></div><div class="line"><span class="comment"> * In real Time Highly Advanced Computational Applications for Finite Volumes </span></div><div class="line"><span class="comment"> * Copyright (C) 2017 by the ITHACA-FV authors</span></div><div class="line"><span class="comment">-------------------------------------------------------------------------------</span></div><div class="line"><span class="comment">License</span></div><div class="line"><span class="comment">    This file is part of ITHACA-FV</span></div><div class="line"><span class="comment">    ITHACA-FV is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment">    it under the terms of the GNU Lesser General Public License as published by</span></div><div class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><span class="comment">    (at your option) any later version.</span></div><div class="line"><span class="comment">    ITHACA-FV is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><span class="comment">    GNU Lesser General Public License for more details.</span></div><div class="line"><span class="comment">    You should have received a copy of the GNU Lesser General Public License</span></div><div class="line"><span class="comment">    along with ITHACA-FV. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment">Description</span></div><div class="line"><span class="comment">    Example of an unsteady NS Reduction Problem</span></div><div class="line"><span class="comment">SourceFiles</span></div><div class="line"><span class="comment">    04unsteadyNS.C</span></div><div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="unsteadyNS_8H.html">unsteadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAPOD_8H.html">ITHACAPOD.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reducedUnsteadyNS_8H.html">reducedUnsteadyNS.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ITHACAstream_8H.html">ITHACAstream.H</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;math.h&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;iomanip&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classtutorial04.html">tutorial04</a>: <span class="keyword">public</span> <a class="code" href="classunsteadyNS.html">unsteadyNS</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">explicit</span> <a class="code" href="classtutorial04.html#a381d5e381959df54e8e6f8d05084693d">tutorial04</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">        :</div><div class="line">        <a class="code" href="classunsteadyNS.html#a94671a2e15e331569938cb3bd4fb5ba7">unsteadyNS</a>(argc, argv),</div><div class="line">        <a name="a22"></a><a class="code" href="classtutorial04.html#a84a66fb3ac8a6a6c0b85cfcc4341d0a8">U</a>(<a class="code" href="classsteadyNS.html#ae8b03bc316b446d3ad311a80c5ada715">_U</a>()),</div><div class="line">        <a name="a23"></a><a class="code" href="classtutorial04.html#a90a63bb872d2d28151a572adcaa8f9af">p</a>(<a class="code" href="classsteadyNS.html#afe342c9980231332bb8c22bbceb32254">_p</a>())</div><div class="line">    {}</div><div class="line"></div><div class="line">    <span class="comment">// Fields To Perform</span></div><div class="line">    volVectorField&amp; <a class="code" href="classtutorial04.html#a84a66fb3ac8a6a6c0b85cfcc4341d0a8">U</a>;</div><div class="line">    volScalarField&amp; <a class="code" href="classtutorial04.html#a90a63bb872d2d28151a572adcaa8f9af">p</a>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classtutorial04.html#a77204ed6266f44aad66503d46b81b917">offlineSolve</a>()</div><div class="line">    {</div><div class="line">        Vector&lt;double&gt; inl(0, 0, 0);</div><div class="line">        label BCind = 1;</div><div class="line">        List&lt;scalar&gt; mu_now(1);</div><div class="line">        Info &lt;&lt; <span class="stringliteral">&quot;here&quot;</span> &lt;&lt; endl;</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="classreductionProblem.html#a752b5e2d6094c1ee18da4850443f1617">offline</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="classITHACAstream.html#a7fbeebc9ef783c3fbaffac04f18ccd4d">ITHACAstream::read_fields</a>(<a class="code" href="classsteadyNS.html#a4efe3474afaa557ad5a211631115124f">Ufield</a>, <a class="code" href="classtutorial04.html#a84a66fb3ac8a6a6c0b85cfcc4341d0a8">U</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">            <a class="code" href="classITHACAstream.html#a7fbeebc9ef783c3fbaffac04f18ccd4d">ITHACAstream::read_fields</a>(<a class="code" href="classsteadyNS.html#a30b8d9c76cc7f7f4d7dd6406cedba537">Pfield</a>, <a class="code" href="classtutorial04.html#a90a63bb872d2d28151a572adcaa8f9af">p</a>, <span class="stringliteral">&quot;./ITHACAoutput/Offline/&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">for</span> (label <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>.cols(); <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line">            {</div><div class="line">                inl[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line">                mu_now[0] = <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line">                <span class="comment">//assignBC(U, BCind, inl);</span></div><div class="line">                <a class="code" href="classreductionProblem.html#a5c9c99f98e576423c196093a72e2ce98">assignIF</a>(<a class="code" href="classtutorial04.html#a84a66fb3ac8a6a6c0b85cfcc4341d0a8">U</a>, inl);</div><div class="line">                <a class="code" href="classsteadyNS.html#a0bef04380f3d0e8e1a8e6fc18ddc056c">change_viscosity</a>( <a class="code" href="classreductionProblem.html#acca797c9e7595c83d45d40c286b9a6ee">mu</a>(0, <a class="code" href="steadyNS_2pEqn_8H.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line">                <a class="code" href="classsteadyNS.html#acff4dd4ea902cfdcbda57897f59c2e13">truthSolve</a>(mu_now);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div><div class="line"><span class="comment">                               Starting the MAIN</span></div><div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div><div class="line"><span class="keywordtype">int</span> <a name="a24"></a><a class="code" href="04unsteadyNS_8C.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// Construct the tutorial04 object</span></div><div class="line">    <a class="code" href="classtutorial04.html">tutorial04</a> example(argc, argv);</div><div class="line"></div><div class="line">    <span class="comment">// Read parameters from ITHACAdict file</span></div><div class="line">    <a class="code" href="classITHACAparameters.html">ITHACAparameters</a> para;</div><div class="line">    <span class="keywordtype">int</span> NmodesUout = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUout&quot;</span>, 15);</div><div class="line">    <span class="keywordtype">int</span> NmodesPout = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPout&quot;</span>, 15);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUPout = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPout&quot;</span>, 15);</div><div class="line">    <span class="keywordtype">int</span> NmodesUproj = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesUproj&quot;</span>, 10);</div><div class="line">    <span class="keywordtype">int</span> NmodesPproj = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesPproj&quot;</span>, 10);</div><div class="line">    <span class="keywordtype">int</span> NmodesSUPproj = para.<a class="code" href="classITHACAparameters.html#a87b488473043188ee5588db8a0bdd461">ITHACAdict</a>-&gt;lookupOrDefault&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;NmodesSUPproj&quot;</span>, 10);</div><div class="line"></div><div class="line"></div><div class="line">    example.Pnumber = 1;</div><div class="line">    example.Tnumber = 10;</div><div class="line">    example.setParameters();</div><div class="line">    <span class="comment">// Set the parameter ranges</span></div><div class="line">    example.mu_range(0, 0) = 0.1;</div><div class="line">    example.mu_range(0, 1) = 0.01;</div><div class="line">    <span class="comment">// Generate equispaced samples inside the parameter range</span></div><div class="line">    example.genEquiPar();</div><div class="line"></div><div class="line">    <span class="comment">// Set the inlet boundaries where we have non homogeneous boundary conditions</span></div><div class="line">    example.inletIndex.resize(1, 2);</div><div class="line">    example.inletIndex(0, 0) = 0;</div><div class="line">    example.inletIndex(0, 1) = 0;</div><div class="line"></div><div class="line">    <span class="comment">// Time parameters</span></div><div class="line">    example.startTime = 0;</div><div class="line">    example.finalTime = 20;</div><div class="line">    example.timeStep = 0.01;</div><div class="line">    example.writeEvery = 1.0;</div><div class="line"></div><div class="line">    <span class="comment">// Perform The Offline Solve;</span></div><div class="line">    example.offlineSolve();</div><div class="line"></div><div class="line">    <span class="comment">// Solve the supremizer problem</span></div><div class="line">    example.solvesupremizer();</div><div class="line"></div><div class="line">    <span class="comment">// Search the lift function</span></div><div class="line">    example.liftSolve();</div><div class="line"></div><div class="line">    <span class="comment">// Create homogeneous basis functions for velocity</span></div><div class="line">    example.computeLift(example.Ufield, example.liftfield, example.Uomfield);</div><div class="line">    </div><div class="line">    <span class="comment">// Perform a POD decomposition for velocity and pressure</span></div><div class="line">    <a class="code" href="classITHACAPOD.html#a6d9df3a9aae4b7a746b5b992f36d16d3">ITHACAPOD::getModes</a>(example.Uomfield, example.Umodes, example.podex, 0, 0, NmodesUout);</div><div class="line">    <a class="code" href="classITHACAPOD.html#a6d9df3a9aae4b7a746b5b992f36d16d3">ITHACAPOD::getModes</a>(example.Pfield, example.Pmodes, example.podex, 0, 0, NmodesPout);</div><div class="line">    <a class="code" href="classITHACAPOD.html#a6d9df3a9aae4b7a746b5b992f36d16d3">ITHACAPOD::getModes</a>(example.supfield, example.supmodes, example.podex, example.supex, 1, NmodesSUPout);</div><div class="line"></div><div class="line">    example.projectSUP(<span class="stringliteral">&quot;./Matrices&quot;</span>, NmodesUproj, NmodesPproj, NmodesSUPproj);</div><div class="line">    </div><div class="line">    <a class="code" href="classreducedUnsteadyNS.html">reducedUnsteadyNS</a> reduced(example);</div><div class="line"></div><div class="line">    <span class="comment">// Set values of the reduced stuff</span></div><div class="line">    reduced.nu = 0.055;</div><div class="line">    reduced.tstart = 0;</div><div class="line">    reduced.finalTime = 15;</div><div class="line">    reduced.dt = 0.01;</div><div class="line"></div><div class="line">    <span class="comment">// Set the online velocity</span></div><div class="line">    Eigen::MatrixXd vel_now(1, 1);</div><div class="line">    vel_now(0, 0) = 2;</div><div class="line">    reduced.solveOnline_sup(vel_now);</div><div class="line">    <span class="comment">// Reconstruct the solution and export it</span></div><div class="line">    reduced.reconstruct_sup(<span class="stringliteral">&quot;./ITHACAoutput/ReconstructionSUP/&quot;</span>, 5);</div><div class="line">    <span class="comment">//reduced.reconstruct_PPE(&quot;./ITHACAoutput/Reconstruction/&quot;,4);</span></div><div class="line">    exit(0);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
